/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@tensorflow/tfjs-core")):"function"==typeof define&&define.amd?define(["exports","@tensorflow/tfjs-core"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).tf=t.tf||{},t.tf)}(this,(function(t,e){"use strict";function n(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,e}var r=n(e),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function a(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function o(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{u(r.next(t))}catch(t){a(t)}}function s(t){try{u(r.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))}function s(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function u(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,a=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function c(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(l(arguments[e]));return t}var h=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return a(e,t),e}(Error),p=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return a(e,t),e}(Error),f=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return a(e,t),e}(Error),d=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return a(e,t),e}(Error),g=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return a(e,t),e}(Error);!function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}a(e,t)}(Error);var v=function(){function t(t){this.maxEntries=t||100,this.cache=new Map}return t.prototype.get=function(t){var e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e},t.prototype.put=function(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(t,e)},t.prototype.getMaxEntries=function(){return this.maxEntries},t.prototype.setMaxEntries=function(t){if(t<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got "+t+".");if(this.maxEntries>t)for(var e=0;e<this.maxEntries-t;e++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=t},t}();function m(t,e){if(Array.isArray(t)){for(var n=[],r=0;r<e;r++)n=n.concat(t);return n}return(n=new Array(e)).fill(t),n}function y(t,e){if(!t)throw new g(e)}function b(t,e){var n,r,i=0;try{for(var a=u(t),o=a.next();!o.done;o=a.next()){o.value===e&&i++}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}function w(t){return 1===t.length?t[0]:t}function k(t){return Array.isArray(t)?t:[t]}function x(t){var e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function S(t){return t.length<=1||-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,(function(t,e){return e.toUpperCase()}))}var N={};function E(t){if(null==t)return null;var e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function I(t){var e,n;if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((function(t){return I(t)}));else{var r=Object.keys(t);try{for(var i=u(r),a=i.next();!a.done;a=i.next()){var o=a.value,s=t[o];null!=s&&"object"==typeof s&&(Array.isArray(s)||"ndarray"!==s.type||"number"!=typeof s.value?I(s):t[o]=s.value)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}}}function A(t,e,n,r,i){var a,o,s,c,h,p,d,g,v,m,y;if(void 0===e&&(e={}),void 0===n&&(n={}),void 0===r&&(r="object"),void 0===i&&(i=!1),"string"==typeof t){var b=t,w=void 0;if(b in n)w=n[b];else if(b in N)w=N[b];else if(null==(w=e[b]))throw new f("Unknown "+r+": "+t+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return w}var k=t;if(null==k.className||null==k.config)throw new f(r+": Improper config format: "+JSON.stringify(k)+".\n'className' and 'config' must set.");var x=k.className,S=void 0,E=void 0;if(x in n?(S=(a=l(n[x],2))[0],E=a[1]):x in N?(S=(o=l(N.className,2))[0],E=o[1]):x in e&&(S=(s=l(e[x],2))[0],E=s[1]),null==S)throw new f("Unknown "+r+": "+x+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(null!=E){var A={};try{for(var z=u(Object.keys(N)),C=z.next();!C.done;C=z.next()){A[L=C.value]=N[L]}}catch(t){c={error:t}}finally{try{C&&!C.done&&(h=z.return)&&h.call(z)}finally{if(c)throw c.error}}try{for(var T=u(Object.keys(n)),_=T.next();!_.done;_=T.next()){A[L=_.value]=n[L]}}catch(t){p={error:t}}finally{try{_&&!_.done&&(d=T.return)&&d.call(T)}finally{if(p)throw p.error}}k.config.customObjects=A;var D=Object.assign({},N);try{for(var F=u(Object.keys(n)),M=F.next();!M.done;M=F.next()){var L=M.value;N[L]=n[L]}}catch(t){g={error:t}}finally{try{M&&!M.done&&(v=F.return)&&v.call(F)}finally{if(g)throw g.error}}I(k.config);var R=E(S,k.config,n,i);return N=Object.assign({},D),R}D=Object.assign({},N);try{for(var O=u(Object.keys(n)),B=O.next();!B.done;B=O.next()){L=B.value;N[L]=n[L]}}catch(t){m={error:t}}finally{try{B&&!B.done&&(y=O.return)&&y.call(O)}finally{if(m)throw m.error}}R=new S(k.config);return N=Object.assign({},D),R}function z(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function C(t){var e,n;if(null==t)return t;var r=[];try{for(var i=u(t),a=i.next();!a.done;a=i.next()){var o=a.value;-1===r.indexOf(o)&&r.push(o)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function T(t){if(null==t)throw new f("Invalid value in obj: "+JSON.stringify(t));for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function _(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new f(n+" is not a valid "+e+".  Valid values are "+t+" or null/undefined.")}function D(t,e,n,r){return void 0===n&&(n=0),void 0===r&&(r=1/0),y(n>=0),y(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every((function(t){return typeof t===e}))}function F(t,n){Array.isArray(t)?(e.util.assert(t.length>0,(function(){return n+" is unexpectedly an empty array."})),t.forEach((function(t,e){return F(t,"element "+(e+1)+" of "+n)}))):e.util.assert(Number.isInteger(t)&&t>0,(function(){return"Expected "+n+" to be a positive integer, but got "+M(t)+"."}))}function M(t){return null===t?"null":Array.isArray(t)?"["+t.map((function(t){return M(t)})).join(",")+"]":"string"==typeof t?'"'+t+'"':""+t}function L(t){return"relu"===t?"relu":"linear"===t?"linear":"elu"===t?"elu":null}var R=0;function O(){return R++}var B={};function P(t){return void 0===t&&(t=""),t in B||(B[t]=0),B[t]+=1,t+B[t].toString()}var W=["channelsFirst","channelsLast"],U=["nearest","bilinear"],j=["valid","same","causal"],K=["max","avg"],V=["sum","mul","concat","ave"],q=new Map;function G(t){_(W,"DataFormat",t)}function H(t){_(j,"PaddingMode",t)}function J(t){_(K,"PoolMode",t)}var Z=[];function Y(t,e){Z.push(t);try{var n=e();return Z.pop(),n}catch(t){throw Z.pop(),t}}function X(t){if(!et(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===Z.length?"":Z.join("/")+"/")+t}function $(t){if(!et(t))throw new Error("Not a valid tensor name: '"+t+"'");q.has(t)||q.set(t,0);var e=q.get(t);if(q.set(t,q.get(t)+1),e>0){var n=t+"_"+e;return q.set(n,1),n}return t}var Q,tt=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function et(t){return!!t.match(tt)}function nt(t,e,n){null==e&&(e=0),null==n&&(n=t.length);for(var r=1,i=e;i<n;++i)r*=t[i];return r}function rt(t){if(0===t.length)return Number.NaN;for(var e=Number.POSITIVE_INFINITY,n=0;n<t.length;n++){var r=t[n];r<e&&(e=r)}return e}function it(t){if(0===t.length)return Number.NaN;for(var e=Number.NEGATIVE_INFINITY,n=0;n<t.length;n++){var r=t[n];r>e&&(e=r)}return e}function at(t,e){if(e<t)throw new f("end ("+e+") < begin ("+t+") is forbidden.");for(var n=[],r=t;r<e;++r)n.push(r);return n}function ot(){return null==Q&&(Q=e.backend().epsilon()),Q}function st(t,e){return r.cast(t,e)}function ut(t,e){void 0===e&&(e=-1);var n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),r.reshape(t,n)}function lt(t,n,i){return e.tidy((function(){switch(t.rank){case 1:return r.slice1d(t,n,i);case 2:return r.slice2d(t,[n,0],[i,t.shape[1]]);case 3:return r.slice3d(t,[n,0,0],[i,t.shape[1],t.shape[2]]);case 4:return r.slice4d(t,[n,0,0,0],[i,t.shape[1],t.shape[2],t.shape[3]]);case 5:return r.slice(t,[n,0,0,0,0],[i,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return r.slice(t,[n,0,0,0,0,0],[i,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new f("sliceAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}}))}function ct(t,n,i){return e.tidy((function(){switch(t.rank){case 1:return r.slice1d(t,n,i);case 2:return r.slice2d(t,[0,n],[t.shape[0],i]);case 3:return r.slice3d(t,[0,0,n],[t.shape[0],t.shape[1],i]);case 4:return r.slice4d(t,[0,0,0,n],[t.shape[0],t.shape[1],t.shape[2],i]);default:throw new f("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}}))}function ht(t,n,i,a){return e.tidy((function(){switch(t.rank){case 1:return r.slice1d(t,n,i);case 2:switch(a){case 1:return lt(t,n,i);case 2:return ct(t,n,i);default:throw new f("The axis is not within the rank of the tensor "+a)}case 3:switch(a){case 1:return lt(t,n,i);case 2:return r.slice3d(t,[0,n,0],[t.shape[0],i,t.shape[2]]);case 3:return ct(t,n,i);default:throw new f("The axis is not within the rank of the tensor "+a)}case 4:switch(a){case 1:return lt(t,n,i);case 2:return r.slice4d(t,[0,n,0,0],[t.shape[0],i,t.shape[2],t.shape[3]]);case 3:return r.slice4d(t,[0,0,n,0],[t.shape[0],t.shape[1],i,t.shape[3]]);case 4:return ct(t,n,i);default:throw new f("The axis is not within the rank of the tensor "+a)}default:throw new f("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}}))}function pt(t,e){var n;return void 0===e&&(e=-1),e<0&&(e=0!==(n=t[0].rank)?n:0),e===t[0].rank&&(e=-1),r.concat(t,e)}function ft(t,e){switch(t.rank){case 1:return r.concat1d([t,e]);case 2:return r.concat2d([t,e],0);case 3:return r.concat3d([t,e],0);case 4:return r.concat4d([t,e],0);default:throw new f("concatAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}}function dt(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new f("The length of input n ("+e.length+") does not match the number of dimensions in input x ("+t.rank+")");return r.tile(t,e)}function gt(t,e,n,i,a){return void 0===e&&(e=0),void 0===n&&(n=1),r.randomNormal(t,e,n,i,a)}function vt(t,e,n,i){if(t.rank<2||e.rank<2)throw new d("dot requires both inputs to be rank >= 2 but got x shape = "+t.shape+" and y shape = "+e.shape);if(e.rank>=3&&t.shape.slice(-1)[0]!==(p=e.shape.slice(-2)[0]))throw new d("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+t.shape+" and  y shape = "+e.shape);if(2===t.rank&&2===e.rank){var a=!1,o=!1;return r.fused.matMul({a:t,b:e,transposeA:a,transposeB:o,bias:i?bt(t.rank,i,"channelsLast"):null,activation:n})}var s=t.shape.slice(),u=s.pop();t=r.reshape(t,[-1,u]);var l=e.shape.slice(),h=l.pop(),p=l.pop(),f=c(l,[h]),g=Array.from({length:e.rank},(function(t,n){return 0===n?e.rank-2:n<=e.rank-2?n-1:n}));e=r.reshape(r.transpose(e,g),[p,-1]);var v=c(s,f);a=!1,o=!1;return r.reshape(r.fused.matMul({a:t,b:e,transposeA:a,transposeB:o,bias:i?bt(t.rank,i,"channelsLast"):null,activation:n}),v)}function mt(t,n,i){return e.tidy((function(){return n=Array.isArray(n)?e.tensor1d(n,"int32"):r.cast(n,"int32"),r.gather(t,n,i)}))}function yt(t){return r.mul(t,t)}function bt(t,e,n){var i=e.shape;if(1!==e.rank&&e.rank!==t)throw new f("Unexpected bias dimensions: "+e.rank+"; expected it to be 1 or "+t);if(5===t){if("channelsFirst"===n)return 1===i.length?r.reshape(e,[1,i[0],1,1,1]):r.reshape(e,[1,i[3],i[0],i[1],i[2]]);if("channelsLast"===n)return 1===i.length?r.reshape(e,[1,1,1,1,i[0]]):r.reshape(e,[1].concat(i))}else if(4===t){if("channelsFirst"===n)return 1===i.length?r.reshape(e,[1,i[0],1,1]):r.reshape(e,[1,i[2],i[0],i[1]]);if("channelsLast"===n)return 1===i.length?r.reshape(e,[1,1,1,i[0]]):r.reshape(e,[1].concat(i))}else if(3===t){if("channelsFirst"===n)return 1===i.length?r.reshape(e,[1,i[0],1]):r.reshape(e,[1,i[1],i[0]]);if("channelsLast"===n)return 1===i.length?r.reshape(e,[1,1,i[0]]):r.reshape(e,[1].concat(i))}else if(t<3)return e;throw new f("Unsupported input rank by biasAdd: "+e.rank)}function wt(t,n,i){return e.tidy((function(){return null==i&&(i="channelsLast"),G(i),r.add(t,bt(t.rank,n,i))}))}function kt(t,n,i,a){return e.tidy((function(){return r.dropout(t,n,i,a)}))}function xt(t,e,n){return void 0===n&&(n=!1),n?t():e()}var St=["fanIn","fanOut","fanAvg"],Nt=["normal","uniform","truncatedNormal"];var Et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(e.serialization.Serializable),It=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n.prototype.apply=function(t,n){return e.zeros(t,n)},n}(Et);It.className="Zeros",e.serialization.registerClass(It);var At=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n.prototype.apply=function(t,n){return e.ones(t,n)},n}(Et);At.className="Ones",e.serialization.registerClass(At);var zt=function(t){function n(e){var n=t.call(this)||this;if("object"!=typeof e)throw new f("Expected argument of type ConstantConfig but got "+e);if(void 0===e.value)throw new f("config must have value set but got "+e);return n.value=e.value,n}return a(n,t),n.prototype.apply=function(t,n){var r=this;return e.tidy((function(){return e.mul(e.scalar(r.value),e.ones(t,n))}))},n.prototype.getConfig=function(){return{value:this.value}},n}(Et);zt.className="Constant",e.serialization.registerClass(zt);var Ct=function(t){function n(e){var n=t.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=e.minval||n.DEFAULT_MINVAL,n.maxval=e.maxval||n.DEFAULT_MAXVAL,n.seed=e.seed,n}return a(n,t),n.prototype.apply=function(t,n){return e.randomUniform(t,this.minval,this.maxval,n)},n.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},n}(Et);Ct.className="RandomUniform",e.serialization.registerClass(Ct);var Tt=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return a(e,t),e.prototype.apply=function(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new d("randomNormal does not support dType "+e+".");return gt(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(Et);Tt.className="RandomNormal",e.serialization.registerClass(Tt);var _t=function(t){function n(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return a(n,t),n.prototype.apply=function(t,n){if("float32"!==(n=n||"float32")&&"int32"!==n)throw new d("truncatedNormal does not support dType "+n+".");return e.truncatedNormal(t,this.mean,this.stddev,n,this.seed)},n.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},n}(Et);_t.className="TruncatedNormal",e.serialization.registerClass(_t);var Dt=function(t){function n(e){var n=t.call(this)||this;return n.gain=null!=e.gain?e.gain:1,n}return a(n,t),n.prototype.apply=function(t,n){var r=this;return e.tidy((function(){if(2!==t.length||t[0]!==t[1])throw new f("Identity matrix initializer can only be used for 2D square matrices.");return e.mul(r.gain,e.eye(t[0]))}))},n.prototype.getConfig=function(){return{gain:this.gain}},n}(Et);Dt.className="Identity",e.serialization.registerClass(Dt);var Ft=function(t){function n(e){var n,r=t.call(this)||this;if(e.scale<0)throw new f("scale must be a positive float. Got: "+e.scale);return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,n=r.mode,_(St,"FanMode",n),r.distribution=null==e.distribution?"normal":e.distribution,function(t){_(Nt,"Distribution",t)}(r.distribution),r.seed=e.seed,r}return a(n,t),n.prototype.apply=function(t,n){var r=function(t,e){var n,r;if(void 0===e&&(e="channelsLast"),G(e),2===t.length)n=t[0],r=t[1];else if(-1!==[3,4,5].indexOf(t.length))if("channelsFirst"===e){var i=nt(t,2);n=t[1]*i,r=t[0]*i}else"channelsLast"===e&&(i=nt(t,0,t.length-2),n=t[t.length-2]*i,r=t[t.length-1]*i);else{var a=nt(t);n=Math.sqrt(a),r=Math.sqrt(a)}return[n,r]}(t),i=r[0],a=r[1],o=this.scale;if("fanIn"===this.mode?o/=Math.max(1,i):"fanOut"===this.mode?o/=Math.max(1,a):o/=Math.max(1,(i+a)/2),"normal"===this.distribution){var s=Math.sqrt(o);if("float32"!==(n=n||"float32")&&"int32"!==n)throw new d(this.getClassName()+" does not support dType "+n+".");return e.truncatedNormal(t,0,s,n,this.seed)}var u=Math.sqrt(3*o);return e.randomUniform(t,-u,u,n)},n.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},n}(Et);Ft.className="VarianceScaling",e.serialization.registerClass(Ft);var Mt=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Ft.className},e}(Ft);Mt.className="GlorotUniform",e.serialization.registerClass(Mt);var Lt=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Ft.className},e}(Ft);Lt.className="GlorotNormal",e.serialization.registerClass(Lt);var Rt=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Ft.className},e}(Ft);Rt.className="HeNormal",e.serialization.registerClass(Rt);var Ot=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Ft.className},e}(Ft);Ot.className="HeUniform",e.serialization.registerClass(Ot);var Bt=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Ft.className},e}(Ft);Bt.className="LeCunNormal",e.serialization.registerClass(Bt);var Pt=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Ft.className},e}(Ft);Pt.className="LeCunNormal",e.serialization.registerClass(Pt);var Wt=function(t){function n(e){var n=t.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=null==e.gain?n.DEFAULT_GAIN:e.gain,n.seed=e.seed,null!=n.seed)throw new d("Random seed is not implemented for Orthogonal Initializer yet.");return n}return a(n,t),n.prototype.apply=function(t,n){var r=this;return e.tidy((function(){if(t.length<2)throw new d("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+t[0]*t[1]+") elements: Slowness may result.");var n=gt(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32"),i=e.linalg.gramSchmidt(n);return t[0]>t[1]&&(i=e.transpose(i)),e.mul(r.gain,i)}))},n.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},n}(Et);Wt.className="Orthogonal",e.serialization.registerClass(Wt);var Ut={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function jt(t,n){return void 0===n&&(n={}),A(t,e.serialization.SerializationMap.getMap().classNameMap,n,"initializer")}function Kt(t){return E(t)}function Vt(t){if("string"==typeof t){var e=t in Ut?Ut[t]:t;if("GlorotNormal"===e)return new Lt;if("GlorotUniform"===e)return new Mt;if("HeNormal"===e)return new Rt;if("HeUniform"===e)return new Ot;if("LeCunNormal"===e)return new Bt;if("LeCunUniform"===e)return new Pt;var n={};return n.className=e,n.config={},jt(n)}return t instanceof Et?t:jt(t)}function qt(t){return Array.isArray(t)&&Array.isArray(t[0])}function Gt(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function Ht(t){var e;if(Array.isArray(t)){if(1!==t.length)throw new f("Expected Tensor length to be 1; got "+t.length);e=t[0]}else e=t;return e}function Jt(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return(t=t)[0];throw new f("Expected exactly 1 Shape; got "+t.length)}return t}function Zt(t){var e,n,r=0;try{for(var i=u(t),a=i.next();!a.done;a=i.next()){var o=a.value;0===o.shape.length?r+=1:r+=o.shape.reduce((function(t,e){return t*e}))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}var Yt="Variable",Xt=function(){function t(t,e,n,i,a){void 0===e&&(e="float32"),void 0===n&&(n=Yt),void 0===i&&(i=!0),void 0===a&&(a=null),this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=O(),n=null==n?Yt:n,this.originalName=X(n),this.name=$(this.originalName),this.trainable_=i,this.constraint=a,this.val=r.variable(t,this.trainable_,this.name,this.dtype)}return t.prototype.read=function(){return this.assertNotDisposed(),this.val},t.prototype.write=function(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},t.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},t.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.trainable_=t,this.val.trainable=t},enumerable:!0,configurable:!0}),t}();function $t(t){return t.map((function(t){return t.read()}))}function Qt(t){t.forEach((function(t){t[0].write(t[1])}))}var te=function(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},ee=function(t,e,n,r,i,a,o){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=O(),null!=a&&(this.originalName=X(a),this.name=$(this.originalName)),this.rank=e.length},ne=0,re=function(){function t(t,e){var n,r;this.callArgs=e,this.id=ne++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;try{for(var i=u(t.inboundLayers),a=i.next();!a.done;a=i.next()){var o=a.value;null!=o&&o.outboundNodes.push(this)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.outboundLayer.inboundNodes.push(this)}return t.prototype.getConfig=function(){var t,e,n=[];try{for(var r=u(this.inboundLayers),i=r.next();!i.done;i=r.next()){var a=i.value;null!=a?n.push(a.name):n.push(null)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},t}(),ie=0,ae=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=ie++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var r=e.name;if(!r){var i=n.getClassName();r=x(i)+"_"+P(i)}if(n.name=r,n.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){var a=void 0;if(null!=e.batchInputShape)a=e.batchInputShape;else if(null!=e.inputShape){var o=null;null!=e.batchSize&&(o=e.batchSize),a=[o].concat(e.inputShape)}n.batchInputShape=a;var s=e.dtype;null==s&&(s=e.inputDType),null==s&&(s="float32"),n.dtype=s}return null!=e.weights?n.initialWeights=e.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return a(n,t),n.nodeKey=function(t,e){return t.name+"_ib-"+e.toString()},n.prototype.getNodeAtIndex=function(t,e){if(0===this.inboundNodes.length)throw new p("The layer has never been called and thus has no defined "+e+".");if(this.inboundNodes.length<=t)throw new f("Asked to get "+e+" at node "+t+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[t]},n.prototype.getInputAt=function(t){return w(this.getNodeAtIndex(t,"input").inputTensors)},n.prototype.getOutputAt=function(t){return w(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(n.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new h("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new h("Layer "+this.name+" is not connected, no input to return.");return w(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new h("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new h("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return w(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),n.prototype.calculateLosses=function(){return this.losses.map((function(t){return t()}))},Object.defineProperty(n.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach((function(e){return e.trainable=t})),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter((function(t){return t.trainable})):[]},set:function(t){this._trainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter((function(t){return!t.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),n.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},n.prototype.assertInputCompatibility=function(t){if(t=k(t),null!=this.inputSpec&&0!==this.inputSpec.length){var e=k(this.inputSpec);if(t.length!==e.length)throw new f("Layer "+this.name+" expects "+e.length+" inputs, but it received "+t.length+" input tensors. Input received: "+t);for(var n=0;n<t.length;n++){var r=t[n],i=e[n];if(null!=i){var a=r.rank;if(null!=i.ndim&&a!==i.ndim)throw new f("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+i.ndim+", found ndim="+a);if(null!=i.maxNDim&&a>i.maxNDim)throw new f("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+i.maxNDim+", found ndim="+a);if(null!=i.minNDim&&a<i.minNDim)throw new f("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+i.minNDim+", found ndim="+a+".");if(null!=i.dtype&&r.dtype!==i.dtype)throw new f("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+i.dtype+", found dtype="+r.dtype+".");if(i.axes){var o=r.shape;for(var s in i.axes){var u=Number(s),l=i.axes[s],c=u>=0?o[u]:o[o.length+u];if(null!=l&&-1===[l,null].indexOf(c))throw new f("Input "+n+" is incompatible with layer "+this.name+": expected axis "+u+" of input shape to have value "+l+" but got shape "+o+".")}}if(null!=i.shape)for(var h=0;h<i.shape.length;++h){var p=i.shape[h],d=r.shape[h];if(null!=p&&null!=d&&p!==d)throw new f("Input "+n+" is incompatible with layer "+this.name+": expected shape="+i.shape+", found shape="+r.shape+".")}}}}},n.prototype.call=function(t,e){return t},n.prototype.invokeCallHook=function(t,e){null!=this._callHook&&this._callHook(t,e)},n.prototype.setCallHook=function(t){this._callHook=t},n.prototype.clearCallHook=function(){this._callHook=null},n.prototype.apply=function(t,e){var n,r,i,a,o=this;e=e||{},this.assertNotDisposed();var s=k(t),l=!0;try{for(var c=u(s),h=c.next();!h.done;h=c.next()){if(!(h.value instanceof ee)){l=!1;break}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}var p=!0;try{for(var g=u(s),v=g.next();!v.done;v=g.next()){if(v.value instanceof ee){p=!1;break}}}catch(t){i={error:t}}finally{try{v&&!v.done&&(a=g.return)&&a.call(g)}finally{if(i)throw i.error}}if(l===p)throw new f("Arguments to apply() must be all SymbolicTensors or all Tensors");return Y(this.name,(function(){var n,r,i,a;if(!o.built){o.assertInputCompatibility(t);var l=[];try{for(var c=u(k(t)),h=c.next();!h.done;h=c.next()){var f=h.value;l.push(f.shape)}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}o.build(w(l)),o.built=!0,o.initialWeights&&o.setWeights(o.initialWeights),null===o._refCount&&p&&(o._refCount=1)}if(o.assertInputCompatibility(t),p){var g=k(N=o.call(t,e)),v=[];try{for(var m=u(g),y=m.next();!y.done;y=m.next()){var b=y.value;-1!==s.indexOf(b)&&(b=b.clone()),v.push(b)}}catch(t){i={error:t}}finally{try{y&&!y.done&&(a=m.return)&&a.call(m)}finally{if(i)throw i.error}}if(N=w(v),null!=o.activityRegularizer)throw new d("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return N}var x=function(t){var e,n;t=k(t);var r=[];try{for(var i=u(t),a=i.next();!a.done;a=i.next()){var o=a.value;r.push(o.shape)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return w(r)}(t),S=o.computeOutputShape(x),N=void 0,E="float32";if(o.warnOnIncompatibleInputShape(Array.isArray(t)?x[0]:x),N=null!=S&&S.length>0&&Array.isArray(S[0])?S.map((function(n,r){return new ee(E,n,o,k(t),e,o.name,r)})):new ee(E,S,o,k(t),e,o.name),o.addInboundNode(t,N,null,null,x,S,e),o._refCount++,null!=o.activityRegularizer)throw new d("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return N}))},n.prototype.warnOnIncompatibleInputShape=function(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(t)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var e=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=t[r]&&t[r]!==n&&(e=!0)})),e&&console.warn("The shape of the input tensor ("+JSON.stringify(t)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(n.prototype,"outputShape",{get:function(){var t,e;if(null==this.inboundNodes||0===this.inboundNodes.length)throw new h("The layer "+this.name+" has never been called and thus has no defined output shape.");var n=[];try{for(var r=u(this.inboundNodes),i=r.next();!i.done;i=r.next()){var a=i.value,o=JSON.stringify(a.outputShapes);-1===n.indexOf(o)&&n.push(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}if(1===n.length){var s=this.inboundNodes[0].outputShapes;return Array.isArray(s)&&Array.isArray(s[0])&&1===s.length?s[0]:s}throw new h("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),n.prototype.countParams=function(){if(!this.built)throw new p("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return Zt(this.weights)},n.prototype.build=function(t){this.built=!0},n.prototype.getWeights=function(t){return void 0===t&&(t=!1),$t(t?this.trainableWeights:this.weights)},n.prototype.setWeights=function(t){var n=this;e.tidy((function(){var r=n.weights;if(r.length!==t.length)throw new f('You called setWeights(weights) on layer "'+n.name+'" with a weight list of length '+t.length+", but the layer was expecting "+r.length+" weights. Provided weights: "+t+"...");if(0!==r.length){for(var i=[],a=$t(r),o=0;o<a.length;++o){var s=a[o],u=r[o],l=t[o];if(!e.util.arraysEqual(s.shape,l.shape))throw new f("Layer weight shape "+s.shape+" not compatible with provided weight shape "+l.shape);i.push([u,l])}Qt(i)}}))},n.prototype.addWeight=function(t,e,n,r,i,a,o,s){if(-1!==this._addedWeightNames.indexOf(t))throw new f("Duplicate weight name "+t+" for layer "+this.name);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():Vt("zeros"));var u=r.apply(e,n),l=new Xt(u,n,t,a,o);return u.dispose(),null!=i&&this.addLoss((function(){return i.apply(l.read())})),null==a&&(a=!0),a?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l},n.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},n.prototype.addLoss=function(t){var e;null==t||Array.isArray(t)&&0===t.length||(t=k(t),void 0!==this._losses&&null!==this._losses&&(e=this.losses).push.apply(e,c(t)))},n.prototype.computeOutputShape=function(t){return t},n.prototype.computeMask=function(t,e){var n=this;if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");e.forEach((function(t){if(null!=t)throw new TypeError("Layer "+n.name+" does not support masking, but was passed an inputMask.")}))}return null}return e},n.prototype.addInboundNode=function(t,e,n,r,i,a,o){var s,l;void 0===o&&(o=null);var c=k(t);e=k(e),n=k(n),r=k(r),i=Gt(i),a=Gt(a);var h=[],p=[],f=[];try{for(var d=u(c),g=d.next();!g.done;g=d.next()){var v=g.value;h.push(v.sourceLayer),p.push(v.nodeIndex),f.push(v.tensorIndex)}}catch(t){s={error:t}}finally{try{g&&!g.done&&(l=d.return)&&l.call(d)}finally{if(s)throw s.error}}new re({outboundLayer:this,inboundLayers:h,nodeIndices:p,tensorIndices:f,inputTensors:c,outputTensors:e,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:a},o);for(var m=0;m<e.length;m++)e[m].sourceLayer=this,e[m].nodeIndex=this.inboundNodes.length-1,e[m].tensorIndex=m},n.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t},n.prototype.disposeWeights=function(){return this.weights.forEach((function(t){return t.dispose()})),this.weights.length},n.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},n.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},n}(e.serialization.Serializable);function oe(t,e,n){var r,i;if((null==e||null!=n&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),0===e.inboundNodes.length)return[t];var a=e.inboundNodes[n];if(0===a.inboundLayers.length)return a.inputTensors;for(var o=[],s=0;s<a.inboundLayers.length;s++){var l=oe(a.inputTensors[s],a.inboundLayers[s],a.nodeIndices[s]);try{for(var c=(r=void 0,u(l)),h=c.next();!h.done;h=c.next()){var p=h.value;-1===o.indexOf(p)&&o.push(p)}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}return o}var se=function(t){function e(e){var n=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:P("input").toString()})||this;if(null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new f("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var r=e.batchInputShape;if(null==r){if(null==e.inputShape)throw new f("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new f("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";n.batchInputShape=r,n.dtype=i,n.inputSpec=[{shape:r}];var a=new ee(n.dtype,n.batchInputShape,n,[],{},n.name);return a.nodeIndex=0,a.tensorIndex=0,new re({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[a],outputTensors:[a],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]}),n}return a(e,t),e.prototype.apply=function(t,e){throw new f("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e}(ae);function ue(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new f("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));var n=t.dtype;return null==n&&(n="float32"),new se({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}se.className="InputLayer",e.serialization.registerClass(se);var le=function(){function t(e){var n,r;if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof t)for(var i in e.id2Value)this.id2Value[i]=e.id2Value[i],i in e.id2Mask&&(this.id2Mask[i]=e.id2Mask[i]);else{if(null==e)return;try{for(var a=u(e),o=a.next();!o.done;o=a.next()){var s=o.value;this.add(s.key,s.value)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}}return t.prototype.add=function(t,n,r){if(null!=this.id2Value[t.id])throw new f("Duplicate key: name="+t.name+", id="+t.id);return this.id2Value[t.id]=function(t,n){if(null==t.dtype||t.dtype===n.dtype)return n;try{return e.cast(n,t.dtype)}catch(e){throw new f("The dtype of the feed ("+n.dtype+") can not be cast to the dtype of the key '"+t.name+"' ("+t.dtype+").")}}(t,n),this.name2Id[t.name]=t.id,null!=r&&(this.id2Mask[t.id]=r),this},t.prototype.addFeed=function(t){this.add(t.key,t.value)},t.prototype.hasKey=function(t){return null!=this.id2Value[t.id]},t.prototype.names=function(){return Object.keys(this.name2Id)},t.prototype.getValue=function(t){if(t instanceof ee){if(null==this.id2Value[t.id])throw new f("Nonexistent key: "+t.name);return this.id2Value[t.id]}var e=this.name2Id[t];if(null==e)throw new f("Feed dict has no SymbolicTensor name: "+t);return this.id2Value[e]},t.prototype.getMask=function(t){if(t instanceof ee){if(null==this.id2Value[t.id])throw new f("Nonexistent key: "+t.name);return this.id2Mask[t.id]}var e=this.name2Id[t];if(null==e)throw new f("Feed dict has no SymbolicTensor name: "+t);return this.id2Mask[e]},t.prototype.disposeMasks=function(){null!=this.id2Mask&&e.dispose(this.id2Mask)},t}(),ce=new v,he=new v;function pe(t,n,r,i){var a,o,s,l,c=null!=r&&r.training,h=Array.isArray(t),p=h?t:[t],f=p.map((function(t){return t.name})),d=[],g=n.names();try{for(var v=u(f),m=v.next();!m.done;m=v.next()){var y=m.value;-1!==g.indexOf(y)?d.push(n.getValue(y)):d.push(null)}}catch(t){a={error:t}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(a)throw a.error}}null!=i&&(i.maxNumTensors=-1/0,i.minNumTensors=1/0);var b,w=f.join(",")+"|"+n.names().sort().join(","),x=ce.get(w);if(null==x){var S=function(t,n){var r,i,a,o;e.util.assert(null!=t&&t.length>0,(function(){return"Expected at least one fetch, got none"}));var s=[],l={};if(1===t.length){var c=de(t[0],n);s=c.sorted,l=c.recipientMap}else{var h=new Set;try{for(var p=u(t),f=p.next();!f.done;f=p.next()){var d=de(f.value,n),g=d.sorted,v=d.recipientMap;try{for(var m=(a=void 0,u(g)),y=m.next();!y.done;y=m.next()){var b=y.value;h.has(b.name)||(s.push(b),h.add(b.name))}}catch(t){a={error:t}}finally{try{y&&!y.done&&(o=m.return)&&o.call(m)}finally{if(a)throw a.error}}var w=function(t){null==l[t]&&(l[t]=new Set),v[t].forEach((function(e){return l[t].add(e)}))};for(var k in v)w(k)}}catch(t){r={error:t}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}return{sorted:s,recipientCounts:fe(l)}}(p,n);x=S.sorted,b=S.recipientCounts,ce.put(w,x),he.put(w,b)}b={},c||Object.assign(b,he.get(w));for(var N=new le(n),E=0;E<x.length;++E){if(null!=i){var I=e.memory().numTensors;I>i.maxNumTensors&&(i.maxNumTensors=I),I<i.minNumTensors&&(i.minNumTensors=I)}var A=x[E],z=A.sourceLayer;if(!(z instanceof se)){var C=[],T=[],_=[],D=!1;try{for(var F=(s=void 0,u(A.inputs)),M=F.next();!M.done;M=F.next()){var L=M.value,R=N.getValue(L),O=N.getMask(L);C.push(R),T.push(O),null!=O&&(D=!0),c||(b[L.name]--,0!==b[L.name]||n.hasKey(L)||-1!==f.indexOf(L.name)||R.isDisposed||!0===L.sourceLayer.stateful||_.push(R))}}catch(t){s={error:t}}finally{try{M&&!M.done&&(l=F.return)&&l.call(F)}finally{if(s)throw s.error}}D&&((r=r||{}).mask=T[0]);var B=k(z.apply(C,r)),P=null;z.supportsMasking&&(P=z.computeMask(C,T));for(var W=ge(A),U=Array.isArray(W)?W:[W],j=0;j<U.length;++j){N.hasKey(U[j])||N.add(U[j],B[j],Array.isArray(P)?P[0]:P);var K=f.indexOf(U[j].name);-1!==K&&(d[K]=B[j])}c||e.dispose(_)}}return N.disposeMasks(),h?d:d[0]}function fe(t){var e={};for(var n in t)e[n]=t[n].size;return e}function de(t,e){var n,r,i,a,o=new Set,s=[],l={};try{for(var c=u(e.names()),h=c.next();!h.done;h=c.next()){var p=h.value;o.add(p)}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}var f=[],d=[];for(f.push(t);f.length>0;){var g=f[f.length-1];if(o.has(g.name))f.pop();else{var v=d[d.length-1]===f.length-1;if(0===g.inputs.length||v)f.pop(),s.push(g),o.add(g.name),v&&d.pop();else{d.push(f.length-1);try{for(var m=(i=void 0,u(g.inputs)),y=m.next();!y.done;y=m.next()){var b=y.value;null==l[b.name]&&(l[b.name]=new Set),l[b.name].add(g.name),o.has(b.name)||f.push(b)}}catch(t){i={error:t}}finally{try{y&&!y.done&&(a=m.return)&&a.call(m)}finally{if(i)throw i.error}}}}}return{sorted:s,recipientMap:l}}function ge(t){var e,n,r;if(1===t.sourceLayer.inboundNodes.length)r=t.sourceLayer.output;else{for(var i=null,a=0;a<t.sourceLayer.inboundNodes.length;++a)try{for(var o=(e=void 0,u(t.sourceLayer.inboundNodes[a].outputTensors)),s=o.next();!s.done;s=o.next()){if(s.value.id===t.id){i=a;break}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}r=t.sourceLayer.getOutputAt(i)}return r}e.env().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(t){null!=ce&&ce.setMaxEntries(t),null!=he&&he.setMaxEntries(t)}));var ve="Acos",me="Acosh",ye="Add",be="AddN",we="ArgMax",ke="ArgMin",xe="Asin",Se="Asinh",Ne="Atan",Ee="Atanh",Ie="Atan2",Ae="AvgPool",ze="AvgPool3D",Ce="BatchMatMul",Te="BatchToSpaceND",_e="Cast",De="Ceil",Fe="ClipByValue",Me="ComplexAbs",Le="Concat",Re="Conv2D",Oe="Conv2DBackpropInput",Be="Conv3D",Pe="Cosh",We="Cumsum",Ue="DepthwiseConv2dNative",je="Dilation2D",Ke="RealDiv",Ve="Einsum",qe="ExpandDims",Ge="Expm1",He="Floor",Je="FloorDiv",Ze="FusedBatchNorm",Ye="GatherV2",Xe="GreaterEqual",$e="Identity",Qe="IsFinite",tn="IsInf",en="IsNan",nn="LeakyRelu",rn="Log1p",an="Maximum",on="MaxPool",sn="MaxPool3D",un="Mean",ln="Minimum",cn="MirrorPad",hn="Multiply",pn="OnesLike",fn="OneHot",dn="Pack",gn="PadV2",vn="Prelu",mn="Prod",yn="Reciprocal",bn="Relu",wn="Reshape",kn="ResizeNearestNeighbor",xn="ResizeBilinear",Sn="Relu6",Nn="Reverse",En="Round",In="Rsqrt",An="Select",zn="Selu",Cn="Slice",Tn="Sinh",_n="Sign",Dn="Sigmoid",Fn="Softplus",Mn="Sqrt",Ln="SpaceToBatchND",Rn="SplitV",On="Softmax",Bn="SquaredDifference",Pn="Tanh",Wn="Tile",Un="Transpose",jn="Unpack",Kn="UnsortedSegmentSum",Vn="ZerosLike",qn="Step",Gn="FromPixels",Hn="_FusedMatMul",Jn="FusedConv2D",Zn="FusedDepthwiseConv2D",Yn=function(){function t(){}return t.prototype.refCount=function(t){return Xn("refCount")},t.prototype.incRef=function(t){return Xn("incRef")},t.prototype.timerAvailable=function(){return!0},t.prototype.time=function(t){return Xn("time")},t.prototype.read=function(t){return Xn("read")},t.prototype.readSync=function(t){return Xn("readSync")},t.prototype.readToGPU=function(t,e){return Xn("readToGPU")},t.prototype.numDataIds=function(){return Xn("numDataIds")},t.prototype.disposeData=function(t,e){return Xn("disposeData")},t.prototype.write=function(t,e,n){return Xn("write")},t.prototype.move=function(t,e,n,r,i){return Xn("move")},t.prototype.memory=function(){return Xn("memory")},t.prototype.floatPrecision=function(){return Xn("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.dispose=function(){return Xn("dispose")},t}();function Xn(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen")}function $n(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function Qn(t,e,n){void 0===n&&(n=""),$n(rr(t,e),(function(){return n+" Shapes "+t+" and "+e+" must match"}))}function tr(t){$n(null!=t,(function(){return"The input to the tensor constructor must be a non-null value."}))}function er(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!1),null==e&&(e=[]),Array.isArray(t)||sr(t)&&!n)for(var r=0;r<t.length;++r)er(t[r],e,n);else e.push(t);return e}function nr(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function rr(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function ir(t){return t%1==0}function ar(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function or(t,e){var n=e.length;return $n((t=null==t?e.map((function(t,e){return e})):[].concat(t)).every((function(t){return t>=-n&&t<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t})),$n(t.every((function(t){return ir(t)})),(function(){return"All values in axis param must be integers but got axis "+t})),t.map((function(t){return t<0?n+t:t}))}function sr(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function ur(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function lr(t){return"string"==typeof t||t instanceof String}function cr(t){return Array.isArray(t)?cr(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":"number"==typeof t?"float32":lr(t)?"string":function(t){return"boolean"==typeof t}(t)?"bool":"float32"}function hr(t){return!!(t&&t.constructor&&t.call&&t.apply)}function pr(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function fr(t,e,n,r){void 0===r&&(r=!1);var i=new Array;if(1===e.length)for(var a=e[0]*(r?2:1),o=0;o<a;o++)i[o]=n[t+o];else{a=e[0];var s=e.slice(1),u=s.reduce((function(t,e){return t*e}))*(r?2:1);for(o=0;o<a;o++)i[o]=fr(t+o*u,s,n,r)}return i}function dr(t,e,n){if(void 0===n&&(n=!1),0===t.length)return e[0];var r=t.reduce((function(t,e){return t*e}))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error("["+t+"] does not match the input size "+e.length+(n?" for a complex tensor":"")+".");return fr(0,t,e,n)}function gr(t,e){for(var n=vr(t,e),r=0;r<n.length;r++)n[r]=1;return n}function vr(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function mr(t){t.forEach((function(e){$n(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."}))}))}function yr(t){return t&&t.then&&"function"==typeof t.then}var br="tfjsflags",wr=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=kr,this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){null!=this.platform&&(Sr().getBool("IS_TEST")||Sr().getBool("PROD")||console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+".")),this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){var r=this.urlFlags[t];Sr().getBool("IS_TEST")||Sr().getBool("PROD")||console.warn("Setting feature override from URL "+t+": "+r+"."),this.set(t,r)}},t.prototype.getAsync=function(t){return o(this,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return t in this.flags?[2,this.flags[t]]:(e=this.flags,n=t,[4,this.evaluateFlag(t)]);case 1:return e[n]=r.sent(),[2,this.flags[t]]}}))}))},t.prototype.get=function(t){if(t in this.flags)return this.flags[t];var e=this.evaluateFlag(t);if(yr(e))throw new Error("Flag "+t+" cannot be synchronously evaluated. Please use getAsync() instead.");return this.flags[t]=e,this.flags[t]},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if("undefined"!=typeof this.global&&"undefined"!=typeof this.global.location&&"undefined"!=typeof this.global.location.search){var e=this.getQueryParams(this.global.location.search);if(br in e)e.tfjsflags.split(",").forEach((function(e){var n=l(e.split(":"),2),r=n[0],i=n[1];t.urlFlags[r]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}(r,i)}))}},t}();function kr(t){var e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return xr(e,n[0],n[1]),n.join("=")})),e}function xr(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function Sr(){return Er}var Nr,Er=null;function Ir(){if(null==Nr){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Nr=t}return Nr}function Ar(t,e){var n,r=(null==(n=Ir())._tfGlobals&&(n._tfGlobals=new Map),n._tfGlobals);if(r.has(t))return r.get(t);var i=e();return r.set(t,i),r.get(t)}function zr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Sr().getBool("IS_TEST")||Sr().getBool("PROD")||console.warn.apply(console,c(t))}var Cr=Ar("kernelRegistry",(function(){return new Map})),Tr=Ar("gradRegistry",(function(){return new Map}));function _r(t,e){var n=function(t,e){return e+"_"+t}(t,e);return Cr.get(n)}function Dr(t){return Tr.get(t)}function Fr(t){for(var e=Cr.entries(),n=[];;){var r=e.next(),i=r.done,a=r.value;if(i)break;var o=l(a,2),s=o[0],u=o[1];l(s.split("_"),1)[0]===t&&n.push(u)}return n}var Mr=Rr,Lr=null;try{Lr=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function Rr(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function Or(t){return!0===(t&&t.__isLong__)}Rr.prototype.__isLong__,Object.defineProperty(Rr.prototype,"__isLong__",{value:!0}),Rr.isLong=Or;var Br={},Pr={};function Wr(t,e){var n,r,i;return e?(i=0<=(t>>>=0)&&t<256)&&(r=Pr[t])?r:(n=jr(t,(0|t)<0?-1:0,!0),i&&(Pr[t]=n),n):(i=-128<=(t|=0)&&t<128)&&(r=Br[t])?r:(n=jr(t,t<0?-1:0,!1),i&&(Br[t]=n),n)}function Ur(t,e){if(isNaN(t))return e?Xr:Yr;if(e){if(t<0)return Xr;if(t>=Hr)return ni}else{if(t<=-Jr)return ri;if(t+1>=Jr)return ei}return t<0?Ur(-t,e).neg():jr(t%Gr|0,t/Gr|0,e)}function jr(t,e,n){return new Rr(t,e,n)}Rr.fromInt=Wr,Rr.fromNumber=Ur,Rr.fromBits=jr;var Kr=Math.pow;function Vr(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return Yr;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Vr(t.substring(1),e,n).neg();for(var i=Ur(Kr(n,8)),a=Yr,o=0;o<t.length;o+=8){var s=Math.min(8,t.length-o),u=parseInt(t.substring(o,o+s),n);if(s<8){var l=Ur(Kr(n,s));a=a.mul(l).add(Ur(u))}else a=(a=a.mul(i)).add(Ur(u))}return a.unsigned=e,a}function qr(t,e){return"number"==typeof t?Ur(t,e):"string"==typeof t?Vr(t,e):jr(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}Rr.fromString=Vr,Rr.fromValue=qr;var Gr=4294967296,Hr=Gr*Gr,Jr=Hr/2,Zr=Wr(1<<24),Yr=Wr(0);Rr.ZERO=Yr;var Xr=Wr(0,!0);Rr.UZERO=Xr;var $r=Wr(1);Rr.ONE=$r;var Qr=Wr(1,!0);Rr.UONE=Qr;var ti=Wr(-1);Rr.NEG_ONE=ti;var ei=jr(-1,2147483647,!1);Rr.MAX_VALUE=ei;var ni=jr(-1,-1,!0);Rr.MAX_UNSIGNED_VALUE=ni;var ri=jr(0,-2147483648,!1);Rr.MIN_VALUE=ri;var ii=Rr.prototype;ii.toInt=function(){return this.unsigned?this.low>>>0:this.low},ii.toNumber=function(){return this.unsigned?(this.high>>>0)*Gr+(this.low>>>0):this.high*Gr+(this.low>>>0)},ii.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(ri)){var e=Ur(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=Ur(Kr(t,6),this.unsigned),a=this,o="";;){var s=a.div(i),u=(a.sub(s.mul(i)).toInt()>>>0).toString(t);if((a=s).isZero())return u+o;for(;u.length<6;)u="0"+u;o=""+u+o}},ii.getHighBits=function(){return this.high},ii.getHighBitsUnsigned=function(){return this.high>>>0},ii.getLowBits=function(){return this.low},ii.getLowBitsUnsigned=function(){return this.low>>>0},ii.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ri)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},ii.isZero=function(){return 0===this.high&&0===this.low},ii.eqz=ii.isZero,ii.isNegative=function(){return!this.unsigned&&this.high<0},ii.isPositive=function(){return this.unsigned||this.high>=0},ii.isOdd=function(){return 1==(1&this.low)},ii.isEven=function(){return 0==(1&this.low)},ii.equals=function(t){return Or(t)||(t=qr(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},ii.eq=ii.equals,ii.notEquals=function(t){return!this.eq(t)},ii.neq=ii.notEquals,ii.ne=ii.notEquals,ii.lessThan=function(t){return this.comp(t)<0},ii.lt=ii.lessThan,ii.lessThanOrEqual=function(t){return this.comp(t)<=0},ii.lte=ii.lessThanOrEqual,ii.le=ii.lessThanOrEqual,ii.greaterThan=function(t){return this.comp(t)>0},ii.gt=ii.greaterThan,ii.greaterThanOrEqual=function(t){return this.comp(t)>=0},ii.gte=ii.greaterThanOrEqual,ii.ge=ii.greaterThanOrEqual,ii.compare=function(t){if(Or(t)||(t=qr(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},ii.comp=ii.compare,ii.negate=function(){return!this.unsigned&&this.eq(ri)?ri:this.not().add($r)},ii.neg=ii.negate,ii.add=function(t){Or(t)||(t=qr(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,a=t.high>>>16,o=65535&t.high,s=t.low>>>16,u=0,l=0,c=0,h=0;return c+=(h+=i+(65535&t.low))>>>16,l+=(c+=r+s)>>>16,u+=(l+=n+o)>>>16,u+=e+a,jr((c&=65535)<<16|(h&=65535),(u&=65535)<<16|(l&=65535),this.unsigned)},ii.subtract=function(t){return Or(t)||(t=qr(t)),this.add(t.neg())},ii.sub=ii.subtract,ii.multiply=function(t){if(this.isZero())return Yr;if(Or(t)||(t=qr(t)),Lr)return jr(Lr.mul(this.low,this.high,t.low,t.high),Lr.get_high(),this.unsigned);if(t.isZero())return Yr;if(this.eq(ri))return t.isOdd()?ri:Yr;if(t.eq(ri))return this.isOdd()?ri:Yr;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Zr)&&t.lt(Zr))return Ur(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,a=t.high>>>16,o=65535&t.high,s=t.low>>>16,u=65535&t.low,l=0,c=0,h=0,p=0;return h+=(p+=i*u)>>>16,c+=(h+=r*u)>>>16,h&=65535,c+=(h+=i*s)>>>16,l+=(c+=n*u)>>>16,c&=65535,l+=(c+=r*s)>>>16,c&=65535,l+=(c+=i*o)>>>16,l+=e*u+n*s+r*o+i*a,jr((h&=65535)<<16|(p&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},ii.mul=ii.multiply,ii.divide=function(t){if(Or(t)||(t=qr(t)),t.isZero())throw Error("division by zero");var e,n,r;if(Lr)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?jr((this.unsigned?Lr.div_u:Lr.div_s)(this.low,this.high,t.low,t.high),Lr.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Xr:Yr;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Xr;if(t.gt(this.shru(1)))return Qr;r=Xr}else{if(this.eq(ri))return t.eq($r)||t.eq(ti)?ri:t.eq(ri)?$r:(e=this.shr(1).div(t).shl(1)).eq(Yr)?t.isNegative()?$r:ti:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(ri))return this.unsigned?Xr:Yr;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=Yr}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var i=Math.ceil(Math.log(e)/Math.LN2),a=i<=48?1:Kr(2,i-48),o=Ur(e),s=o.mul(t);s.isNegative()||s.gt(n);)s=(o=Ur(e-=a,this.unsigned)).mul(t);o.isZero()&&(o=$r),r=r.add(o),n=n.sub(s)}return r},ii.div=ii.divide,ii.modulo=function(t){return Or(t)||(t=qr(t)),Lr?jr((this.unsigned?Lr.rem_u:Lr.rem_s)(this.low,this.high,t.low,t.high),Lr.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},ii.mod=ii.modulo,ii.rem=ii.modulo,ii.not=function(){return jr(~this.low,~this.high,this.unsigned)},ii.and=function(t){return Or(t)||(t=qr(t)),jr(this.low&t.low,this.high&t.high,this.unsigned)},ii.or=function(t){return Or(t)||(t=qr(t)),jr(this.low|t.low,this.high|t.high,this.unsigned)},ii.xor=function(t){return Or(t)||(t=qr(t)),jr(this.low^t.low,this.high^t.high,this.unsigned)},ii.shiftLeft=function(t){return Or(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?jr(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):jr(0,this.low<<t-32,this.unsigned)},ii.shl=ii.shiftLeft,ii.shiftRight=function(t){return Or(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?jr(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):jr(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},ii.shr=ii.shiftRight,ii.shiftRightUnsigned=function(t){if(Or(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?jr(this.low>>>t|e<<32-t,e>>>t,this.unsigned):jr(32===t?e:e>>>t-32,0,this.unsigned)},ii.shru=ii.shiftRightUnsigned,ii.shr_u=ii.shiftRightUnsigned,ii.toSigned=function(){return this.unsigned?jr(this.low,this.high,!1):this},ii.toUnsigned=function(){return this.unsigned?this:jr(this.low,this.high,!0)},ii.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},ii.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},ii.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},Rr.fromBytes=function(t,e,n){return n?Rr.fromBytesLE(t,e):Rr.fromBytesBE(t,e)},Rr.fromBytesLE=function(t,e){return new Rr(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Rr.fromBytesBE=function(t,e){return new Rr(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};var ai=Mr||Object.assign(Object.create(null),Mr,{default:Mr});function oi(t){return ai.fromString(t,!0,16)}function si(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=er(t)),Sr().getBool("DEBUG")&&function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var n=new Uint8Array(t.length),r=0;r<n.length;++r)0!==Math.round(t[r])&&(n[r]=1);return n}throw new Error("Unknown data type "+e)}function ui(){return Sr().platform.now()}function li(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",Sr().platform.decode(t,e)}oi("c3a5c85c97cb3127"),oi("b492b66fbe98f273"),oi("9ae16a3b2f90404f");var ci=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new hi)}return t.prototype.profileKernel=function(t,e,n){var r,i,a,o,s=function(){a=n()},l=ui();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();try{for(var c=u(a),h=c.next();!h.done;h=c.next()){h.value.dataSync()}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}o=Promise.resolve({kernelMs:ui()-l})}if(Sr().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(e){var n=a[e];n.data().then((function(e){!function(t,e,n){if("float32"!==e)return!1;for(var r=0;r<t.length;r++){var i=t[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}}(e,n.dtype,t)}))},f=0;f<a.length;f++)p(f);return{kernelName:t,outputs:a,inputs:e,timeMs:o.then((function(t){return t.kernelMs})),extraInfo:o.then((function(t){return null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""}))}},t.prototype.logKernelProfile=function(t){var e=this,n=t.kernelName,r=t.outputs,i=t.timeMs,a=t.inputs,o=t.extraInfo;r.forEach((function(t){Promise.all([t.data(),i,o]).then((function(r){e.logger.logKernelProfile(n,t,r[0],r[1],a,r[2])}))}))},t}();var hi=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,i,a){var o="number"==typeof r?ar(r+"ms",9):r.error,s=ar(t,25),u=e.rank,l=e.size,c=ar(e.shape.toString(),14),h="";for(var p in i){var f=i[p];if(null!=f){var d=f.shape||e.shape,g=d.length;h+=p+": "+g+"D "+(g>0?d:"")+" "}}console.log("%c"+s+"\t%c"+o+"\t%c"+u+"D "+c+"\t%c"+l+"\t%c"+h+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}();function pi(t,e,n,r){var i=pr(e),a=function(t,e,n,r){var i=nr(e),a=r[r.length-1],o=new Array(a).fill(0),s=e.length,u="complex64"===n?vi(t):t;if(s>1)for(var l=0;l<i/a;l++)for(var c=l*a,h=0;h<a;h++)o[h]=Math.max(o[h],fi(u[c+h],0,n).length);return o}(t,e,n,i),o=e.length,s=gi(t,e,n,i,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+o),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map((function(t){return"    "+t})).join("\n")),u.join("\n")}function fi(t,e,n){return ar(Array.isArray(t)?parseFloat(t[0].toFixed(7))+" + "+parseFloat(t[1].toFixed(7))+"j":lr(t)?"'"+t+"'":"bool"===n?di(t):parseFloat(t.toFixed(7)).toString(),e)}function di(t){return 0===t?"false":"true"}function gi(t,e,n,r,i,a){void 0===a&&(a=!0);var o="complex64"===n?2:1,s=e[0],u=e.length;if(0===u)return"complex64"===n?[fi(vi(t)[0],0,n)]:"bool"===n?[di(t[0])]:[t[0].toString()];if(1===u){if(s>20){var l=3*o,h=Array.from(t.slice(0,l)),p=Array.from(t.slice((s-3)*o,s*o));return"complex64"===n&&(h=vi(h),p=vi(p)),["["+h.map((function(t,e){return fi(t,i[e],n)})).join(", ")+", ..., "+p.map((function(t,e){return fi(t,i[s-3+e],n)})).join(", ")+"]"]}return["["+("complex64"===n?vi(t):Array.from(t)).map((function(t,e){return fi(t,i[e],n)})).join(", ")+"]"]}var f=e.slice(1),d=r.slice(1),g=r[0]*o,v=[];if(s>20){for(var m=0;m<3;m++){var y=(b=m*g)+g;v.push.apply(v,c(gi(t.slice(b,y),f,n,d,i,!1)))}v.push("...");for(m=s-3;m<s;m++){y=(b=m*g)+g;v.push.apply(v,c(gi(t.slice(b,y),f,n,d,i,m===s-1)))}}else for(m=0;m<s;m++){var b;y=(b=m*g)+g;v.push.apply(v,c(gi(t.slice(b,y),f,n,d,i,m===s-1)))}var w=2===u?",":"";v[0]="["+v[0]+w;for(m=1;m<v.length-1;m++)v[m]=" "+v[m]+w;var k=",\n";for(m=2;m<u;m++)k+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(a?"":k),v}function vi(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var mi=function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=nr(t),null!=n){var i=n.length;$n(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||function(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}(e,this.size),this.strides=pr(t)}return t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),$n(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"}));var i=this.locToIndex(n);this.values[i]=t},t.prototype.get=function(){for(var t,e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];0===n.length&&(n=[0]);var i=0;try{for(var a=u(n),o=a.next();!o.done;o=a.next()){var s=o.value;if(s<0||s>=this.shape[i]){var l="Requested out of range element at "+n+".   Buffer shape="+this.shape;throw new Error(l)}i++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}for(var c=n[n.length-1],h=0;h<n.length-1;++h)c+=this.strides[h]*n[h];return this.values[c]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return yi().makeTensor(this.values,this.shape,this.dtype)},t}(),yi=null,bi=null;var wi=function(){function t(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=nr(t),this.strides=pr(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,bi.buffer(this.shape,this.dtype,t)]}}))}))},t.prototype.bufferSync=function(){return bi.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,dr(this.shape,t,"complex64"===this.dtype)]}}))}))},t.prototype.arraySync=function(){return dr(this.shape,this.dataSync(),"complex64"===this.dtype)},t.prototype.data=function(){return o(this,void 0,void 0,(function(){var t,e;return s(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=yi().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map((function(t){return li(t)}))]}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}}))}))},t.prototype.dataToGPU=function(t){return this.throwIfDisposed(),yi().readToGPU(this.dataId,t)},t.prototype.dataSync=function(){this.throwIfDisposed();var t=yi().readSync(this.dataId);if("string"===this.dtype)try{return t.map((function(t){return li(t)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,yi().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}}))}))},t.prototype.dispose=function(){this.isDisposed||(yi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.print=function(t){return void 0===t&&(t=!1),bi.print(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),bi.clone(this)},t.prototype.toString=function(t){return void 0===t&&(t=!1),pi(this.dataSync(),this.shape,this.dtype,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),bi.cast(this,t)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),yi().makeVariable(this,t,e,n)},t}();Object.defineProperty(wi,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}}),Ar("Tensor",(function(){return wi}));var ki,xi,Si,Ni,Ei,Ii=function(t){function e(e,n,r,i){var a=t.call(this,e.shape,e.dtype,e.dataId,i)||this;return a.trainable=n,a.name=r,a}return a(e,t),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!rr(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");yi().disposeTensor(this),this.dataId=t.dataId,yi().incRef(this,null)},e.prototype.dispose=function(){yi().disposeVariable(this),this.isDisposedInternal=!0},e}(wi);Object.defineProperty(Ii,Symbol.hasInstance,{value:function(t){return t instanceof wi&&null!=t.assign&&t.assign instanceof Function}}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(ki||(ki={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(xi||(xi={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Si||(Si={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Ni||(Ni={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Ei||(Ei={}));var Ai={float32:Ni,int32:xi,bool:Si,complex64:Ei};function zi(t,e){if(t.dtype===e.dtype)return[t,e];var n=function(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return Ai[t][e]}(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Ci(t){var e=[];return Ti(t,e,new Set),e}function Ti(t,e,n){if(null!=t)if(t instanceof wi)e.push(t);else if(r=t,Array.isArray(r)||"object"==typeof r){var r,i=t;for(var a in i){var o=i[a];n.has(o)||(n.add(o),Ti(o,e,n))}}}function _i(t){return null!=t.kernelName}var Di=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(t){return t.name}))))}}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),Fi=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Di}return t.prototype.ready=function(){return o(this,void 0,void 0,(function(){var t,e,n;return s(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,r.label=1;case 1:return e<t.length?(n=t[e],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,n){return void 0===n&&(n=1),t in this.registryFactory?(zr(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},t.prototype.setBackend=function(t){return o(this,void 0,void 0,(function(){var e,n,r;return s(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new ci(this.backendInstance),[2,!0]}}))}))},t.prototype.setupRegisteredKernels=function(){var t=this;Fr(this.backendName).forEach((function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)}))},t.prototype.disposeRegisteredKernels=function(t){var e=this;Fr(t).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(e.registry[t])}))},t.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(null==n)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var r=n.factory();if(!r||r instanceof Yn||"function"!=typeof r.then)return this.registry[t]=r,{success:!0,asyncInit:!1};var i=++this.pendingBackendInitId,a=r.then((function(n){return!(i<e.pendingBackendInitId)&&(e.registry[t]=n,e.pendingBackendInit=null,!0)})).catch((function(n){return i<e.pendingBackendInitId||(e.pendingBackendInit=null,zr("Initialization of backend "+t+" failed"),zr(n.stack||n.message)),!1}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}catch(e){return zr("Initialization of backend "+t+" failed"),zr(e.stack||e.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority}))},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],r=this.initializeBackend(n),i=r.success,a=r.asyncInit;if(a||i)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),r=n.backend,i=this.readSync(e),a=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,i,n.shape,n.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(t,e){var n,r=this,i=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=Mi.runKernel($e,{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(function(t){return{x:function(){var e={x:t},n={dtype:"float32"};return Mi.runKernel(_e,e,n)}}}),[],{}),e},t.prototype.runKernel=function(t,e,n){if(null==this.backendName&&this.backend,!(null!=_r(t,this.backendName)))throw new Error("Kernel '"+t+"' not registered for backend '"+this.backendName+"'");return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(t,e,n){var r=this.backend.numDataIds(),i=0;n.forEach((function(t){i+="complex64"===t.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-e-i-a;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+t+"'")},t.prototype.runKernelFunc=function(t){var e,n,r,i=this,a=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var l=_i(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(_i(t)){var c=t.kernelName,h=t.inputs,p=t.attrs;null==this.backendName&&this.backend;var f=_r(c,this.backendName);$n(null!=f,(function(){return"Cannot find registered kernel '"+c+"' for backend '"+i.backendName+"'"})),n=function(){var t=i.backend.numDataIds();r=f.kernelFunc({inputs:h,attrs:p,backend:i.backend});var e=Array.isArray(r)?r:[r];i.shouldCheckForMemLeaks()&&i.checkKernelForMemLeak(c,t,e);var n=e.map((function(t){return null!=t.rank?t:i.makeTensorFromTensorInfo(t)}));if(o){var s=i.getTensorsForGradient(c,h,n);a=i.saveTensorsForBackwardMode(s)}return n}}else{var d=t.forwardFunc,g=function(t){o&&(a=t.map((function(t){return i.keep(i.clone(t))})))};n=function(){var t=i.backend.numDataIds();r=i.tidy((function(){return d(i.backend,g)}));var e=Array.isArray(r)?r:[r];return i.shouldCheckForMemLeaks()&&i.checkKernelForMemLeak(l,t,e),e}}var v,m=t.inputs,y=t.attrs,b=_i(t)?null:t.backwardsFunc;return this.scopedRun((function(){return i.state.kernelDepth++}),(function(){return i.state.kernelDepth--}),(function(){i.ENV.getBool("DEBUG")||i.state.profiling?(v=i.profiler.profileKernel(l,m,(function(){return n()})),i.ENV.getBool("DEBUG")&&i.profiler.logKernelProfile(v),e=v.outputs):e=n()})),o&&this.addTapeNode(l,m,e,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(m).map((function(t){return null!=m[t]?m[t].shape:null})),outputShapes:e.map((function(t){return t.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(r)?e:e[0]},t.prototype.saveTensorsForBackwardMode=function(t){var e=this;return t.map((function(t){return e.keep(e.clone(t))}))},t.prototype.getTensorsForGradient=function(t,e,n){var r=Dr(t);if(null!=r){var i=r.inputsToSave||[],a=r.outputsToSave||[],o=void 0;r.saveAllInputs?($n(Array.isArray(e),(function(){return"saveAllInputs is true, expected inputs to be an array."})),o=Object.keys(e).map((function(t){return e[t]}))):o=i.map((function(t){return e[t]}));var s=n.filter((function(t,e){return a[e]}));return o.concat(s)}return[]},t.prototype.makeTensor=function(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=t;"string"===n&&lr(t[0])&&(i=t.map((function(t){return e=t,void 0===n&&(n="utf-8"),n=n||"utf-8",Sr().platform.encode(e,n);var e,n})));var a=r.write(i,e,n),o=new wi(e,n,a,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(a),u=function(t){if(null==t)return 0;var e=0;return t.forEach((function(t){return e+=t.length})),e}(i);this.state.numBytes+=u-s.bytes,s.bytes=u}return o},t.prototype.makeTensorFromDataId=function(t,e,n,r){var i={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(i,r)},t.prototype.makeTensorFromTensorInfo=function(t,e){var n=t.dataId,r=t.shape,i=t.dtype,a=new wi(r,i,n,this.nextTensorId());return this.trackTensor(a,e),a},t.prototype.makeVariable=function(t,e,n,r){void 0===e&&(e=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));var i=new Ii(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},t.prototype.trackTensor=function(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*ur(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof Ii||this.track(t)},t.prototype.incRef=function(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)},t.prototype.removeDataId=function(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){var e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){var n=t.size*ur(t.dtype);this.state.numBytes-=n}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i,a,o,l,h,p,f,d;return s(this,(function(s){switch(s.label){case 0:return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],r=this.state.activeProfile,[4,t()];case 1:r.result=s.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,c(this.state.activeProfile.kernels.map((function(t){return t.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,s.label=2;case 2:s.trys.push([2,8,9,10]),i=u(this.state.activeProfile.kernels),a=i.next(),s.label=3;case 3:return a.done?[3,7]:(o=a.value,l=o,[4,o.kernelTimeMs]);case 4:return l.kernelTimeMs=s.sent(),h=o,[4,o.extraInfo];case 5:h.extraInfo=s.sent(),s.label=6;case 6:return a=i.next(),[3,3];case 7:return[3,10];case 8:return p=s.sent(),f={error:p},[3,10];case 9:try{a&&!a.done&&(d=i.return)&&d.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}}))}))},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,n,r,i,a){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},u=Dr(t);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(t){return t=t.map((function(t,e){if(null==t){var r=n[e],i=vr(r.size,r.dtype);return o.makeTensor(i,r.shape,r.dtype)}return t})),r(t.length>1?t:t[0],i,a)}),this.state.activeTape.push(s)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,n=Ci(t),r=new Set(n.map((function(t){return t.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||r.has(a.id)||a.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(t){t.kept||t.scopeId!==o.id||e.track(t)}))},t.prototype.gradients=function(t,e,n,r){var i=this;if(void 0===r&&(r=!1),$n(e.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",t)}));$n(a instanceof wi,(function(){return"The result y returned by f() must be a tensor."}));var o=function(t,e,n){for(var r={},i={},a=0;a<e.length;a++)r[e[a].id]=!0;for(a=0;a<t.length;a++){var o=(d=t[a]).inputs;for(var s in o){for(var u=o[s],l=!1,c=0;c<e.length;c++)if(r[u.id]){d.outputs.forEach((function(t){return r[t.id]=!0})),l=!0,i[d.id]=!0;break}if(l)break}}var h={};h[n.id]=!0;var p={};for(a=t.length-1;a>=0;a--)for(o=(d=t[a]).inputs,c=0;c<d.outputs.length;c++)if(h[d.outputs[c].id]){for(var s in o)h[o[s].id]=!0,p[d.id]=!0;break}var f=[];for(a=0;a<t.length;a++){var d;if(i[(d=t[a]).id]&&p[d.id]){var g={};for(var s in d.inputs){var v=d.inputs[s];r[v.id]&&(g[s]=v)}var m=Object.assign({},d);m.inputs=g,m.outputs=d.outputs,f.push(m)}}return f}(this.state.activeTape,e,a);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var t,r,s={};s[a.id]=null==n?(t=a.shape,r=gr(nr(t),"float32"),Mi.makeTensor(r,t,"float32")):n,function(t,e,n,r){for(var i=function(i){var a=e[i],o=[];if(a.outputs.forEach((function(e){var n=t[e.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+a.kernelName+".");var s=a.gradient(o),u=function(e){if(!(e in s))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(s)+".");var i=n((function(){return s[e]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input "+e+" must have 'float32' dtype, but has '"+i.dtype+"'");var o=a.inputs[e];if(!rr(i.shape,o.shape))throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input '"+e+"' has shape '"+i.shape+"', which does not match the shape of the input '"+o.shape+"'");if(null==t[o.id])t[o.id]=i;else{var u=t[o.id];t[o.id]=r(u,i),u.dispose()}};for(var l in a.inputs)u(l)},a=e.length-1;a>=0;a--)i(a)}(s,o,(function(t){return i.tidy(t)}),Li);var l=e.map((function(t){return s[t.id]}));return 0===i.state.gradientDepth&&(i.state.activeTape.forEach((function(t){var e,n;try{for(var r=u(t.saved),i=r.next();!i.done;i=r.next()){i.value.dispose()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}})),i.state.activeTape=null),{value:a,grads:l}}))},t.prototype.customGrad=function(t){var e=this;return $n(hr(t),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];$n(r.every((function(t){return t instanceof wi})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};r.forEach((function(t,e){a[e]=t}));var o=function(e,i){return $n((n=t.apply(void 0,c(r,[i]))).value instanceof wi,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),$n(hr(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value},s=function(t,e){var i=n.gradFunc(t,e),a=Array.isArray(i)?i:[i];$n(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),$n(a.every((function(t){return t instanceof wi})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(t,e){o[e]=function(){return t}})),o};return e.runKernelFunc({forwardFunc:o,backwardsFunc:s,inputs:a})}},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.readToGPU=function(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)},t.prototype.time=function(t){return o(this,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return e=ui(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=ui()-e,[2,n]}}))}))},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Di,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t}();Fi.nextTensorId=0,Fi.nextVariableId=0;var Mi=function(){var t=Ir();if(null==t._tfengine){var e=new wr(t);t._tfengine=new Fi(e)}return function(t){Er=t}(t._tfengine.ENV),yi=function(){return t._tfengine},t._tfengine}();function Li(t,e){var n={a:t,b:e};return Mi.runKernel(ye,n)}function Ri(t,e){var n=t;if(sr(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||sr(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&Sr().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Oi(t,r,[]),r}function Oi(t,e,n){if(n=n||[],Array.isArray(t)||sr(t)){$n(e.length>0,(function(){return"Element arr["+n.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),$n(t.length===e[0],(function(){return"Element arr["+n.join("][")+"] should have "+e[0]+" elements, but has "+t.length+" elements"}));for(var r=e.slice(1),i=0;i<t.length;++i)Oi(t[i],r,n.concat(i))}else $n(0===e.length,(function(){return"Element arr["+n.join("][")+"] is a primitive, but should be an array/TypedArray of "+e[0]+" elements"}))}function Bi(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}}function Pi(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof wi)return Bi(r,t.dtype,e,n),t;var i=cr(t);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),Bi(r,i,e,n),null==t||!sr(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){var a=null==t?"null":t.constructor.name;throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=Ri(t,i);sr(t)||Array.isArray(t)||(t=[t]);var s="string"!==i?si(t,i):er(t,[],!0);return Mi.makeTensor(s,o,i)}function Wi(t,e,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map((function(t,i){return Pi(t,e+"["+i+"]",n,r)}))}function Ui(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var i=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Mi.startScope(n);try{var i=r.apply(void 0,c(t));return yr(i)&&console.error("Cannot return a Promise inside of tidy."),Mi.endScope(i),i}catch(t){throw Mi.endScope(null),t}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}var ji=Ui({cast_:function(t,e){var n=Pi(t,"x","cast");if(!function(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},i={dtype:e};return Mi.runKernel(_e,r,i)}});var Ki=Ui({mul_:function(t,e){var n,r=Pi(t,"a","mul"),i=Pi(e,"b","mul"),a={a:r=(n=l(zi(r,i),2))[0],b:i=n[1]};return Mi.runKernel(hn,a)}});var Vi=Ui({step_:function(t,e){void 0===e&&(e=0);var n={x:Pi(t,"x","step")},r={alpha:e};return Mi.runKernel(qn,n,r)}}),qi={kernelName:"Abs",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ki(t,Vi(ji(n,"float32"),-1))}}}};var Gi=Ui({floorDiv_:function(t,e){var n,r=Pi(t,"a","floorDiv"),i=Pi(e,"b","floorDiv"),a={a:r=(n=l(zi(r,i),2))[0],b:i=n[1]};return Mi.runKernel(Je,a)}});var Hi=Ui({div_:function(t,e){var n,r=Pi(t,"a","div"),i=Pi(e,"b","div");if(r=(n=l(zi(r,i),2))[0],i=n[1],"int32"===r.dtype&&"int32"===i.dtype)return Gi(r,i);var a={a:r,b:i};return Mi.runKernel(Ke,a,{})}});var Ji=Ui({neg_:function(t){var e={x:Pi(t,"x","neg")};return Mi.runKernel("Neg",e)}});function Zi(t,e,n,r){if(null==r&&(r=cr(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!sr(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){mr(e);var i=nr(e),a=nr(n);$n(i===a,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+a}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==nr(e.slice(o));$n(n[o]===e[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "}))}}return sr(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?si(t,r):er(t,[],!0),Mi.makeTensor(t,e,r)}function Yi(t,e){if((sr(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&sr(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Zi(t,[],[],e)}var Xi=Ui({sqrt_:function(t){var e={x:Pi(t,"x","sqrt","float32")};return Mi.runKernel(Mn,e)}});var $i=Ui({square_:function(t){var e=Pi(t,"x","square");return Mi.runKernel("Square",{x:e},{})}});var Qi=Ui({sub_:function(t,e){var n,r=Pi(t,"a","sub"),i=Pi(e,"b","sub"),a={a:r=(n=l(zi(r,i),2))[0],b:i=n[1]};return Mi.runKernel("Sub",a)}}),ta={kernelName:ve,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){var e=$i(ji(n,"float32")),r=Xi(Qi(Yi(1),e));return Ji(Hi(t,r))}}}},ea={kernelName:me,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){var e=Xi(Qi($i(ji(n,"float32")),1));return Hi(t,e)}}}};function na(t,e){for(var n=[],r=0;r<e.length;r++){var i=t[t.length-r-1],a=e.length-r-1,o=e[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n}function ra(t,e){for(var n=[],r=Math.max(t.length,e.length),i=0;i<r;i++){var a=t[t.length-i-1];null==a&&(a=1);var o=e[e.length-i-1];if(null==o&&(o=1),1===a)n.unshift(o);else if(1===o)n.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(a)}}return n}var ia=Ui({reshape_:function(t,e){var n={x:Pi(t,"x","reshape","string_or_numeric")},r={shape:e};return Mi.runKernel(wn,n,r)}});var aa=Ui({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Pi(t,"x","sum");"bool"===r.dtype&&(r=ji(r,"int32"));var i={x:r},a={axis:e,keepDims:n};return Mi.runKernel("Sum",i,a)}}),oa={kernelName:ye,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=ra(r.shape,i.shape);return{a:function(){var e=t,n=na(r.shape,a);return n.length>0&&(e=aa(e,n)),ia(e,r.shape)},b:function(){var e=t,n=na(i.shape,a);return n.length>0&&(e=aa(e,n)),ia(e,i.shape)}}}},sa={kernelName:be,saveAllInputs:!0,gradFunc:function(t,e){var n={};return e.forEach((function(e,r){n[r]=function(){return t.clone()}})),n}};var ua=Ui({zerosLike_:function(t){var e={x:Pi(t,"x","zerosLike")};return Mi.runKernel(Vn,e)}}),la={kernelName:we,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return ua(n)}}}},ca={kernelName:ke,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return ua(n)}}}},ha={kernelName:xe,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Hi(t,Xi(Qi(Yi(1),$i(ji(n,"float32")))))}}}};var pa=Ui({add_:function(t,e){var n,r=Pi(t,"a","add"),i=Pi(e,"b","add"),a={a:r=(n=l(zi(r,i),2))[0],b:i=n[1]};return Mi.runKernel(ye,a)}}),fa={kernelName:Se,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){var e=Xi(pa(Yi(1),$i(ji(n,"float32"))));return Hi(t,e)}}}},da={kernelName:Ie,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=ra(r.shape,i.shape);return{a:function(){var e=pa($i(r),$i(i)),n=Ki(t,Hi(i,e)),o=na(r.shape,a);return o.length>0&&(n=aa(n,o)),ia(n,r.shape)},b:function(){var e=pa($i(r),$i(i)),n=Ji(Ki(t,Hi(r,e))),o=na(i.shape,a);return o.length>0&&(n=aa(n,o)),ia(n,i.shape)}}}},ga={kernelName:Ne,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Hi(t,pa($i(ji(n,"float32")),1))}}}},va={kernelName:Ee,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Hi(t,Qi(Yi(1),$i(ji(n,"float32"))))}}}};function ma(t,e,n,r,i,a,o,s){var u,c;void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var h=l([-1,-1,-1,-1],4),p=h[0],f=h[1],d=h[2],g=h[3];if("channelsLast"===s)p=(u=l(t,4))[0],f=u[1],d=u[2],g=u[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);p=(c=l(t,4))[0],g=c[1],f=c[2],d=c[3]}var v,m=l(e,4),y=m[0],b=m[1],w=m[3],k=l(ya(n),2),x=k[0],S=k[1],N=l(ya(r),2),E=N[0],I=N[1],A=ba(y,E),z=ba(b,I),C=function(t,e,n,r,i,a,o,s,u){var l,c,h;if("number"==typeof t){l={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var p=function(t,e,n,r,i){null==r&&(r=function(t,e,n,r){void 0===r&&(r=1);var i=ba(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}(t,e,n));var a=t[0],o=t[1],s=wa((a-e+2*r)/n+1,i),u=wa((o-e+2*r)/n+1,i);return[s,u]}([e,n],a,r,t,s);c=p[0],h=p[1]}else if("same"===t){c=Math.ceil(e/r),h=Math.ceil(n/i);var f=Math.max(0,(c-1)*r+a-e),d=Math.max(0,(h-1)*i+o-n);l={top:g=Math.floor(f/2),bottom:v=f-g,left:m=Math.floor(d/2),right:y=d-m,type:"SAME"}}else if("valid"===t)l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-a+1)/r),h=Math.ceil((n-o+1)/i);else{if("object"!=typeof t)throw Error("Unknown padding parameter: "+t);var g,v,m,y;l={top:g="channelsLast"===u?t[1][0]:t[2][0],bottom:v="channelsLast"===u?t[1][1]:t[2][1],left:m="channelsLast"===u?t[2][0]:t[3][0],right:y="channelsLast"===u?t[2][1]:t[3][1],type:0===g&&0===v&&0===m&&0===y?"VALID":"EXPLICIT"},c=wa((e-a+g+v)/r+1,s),h=wa((n-o+m+y)/i+1,s)}return{padInfo:l,outHeight:c,outWidth:h}}(i,f,d,x,S,A,z,a,s),T=C.padInfo,_=C.outHeight,D=C.outWidth,F=o?w*g:w;return"channelsFirst"===s?v=[p,F,_,D]:"channelsLast"===s&&(v=[p,_,D,F]),{batchSize:p,dataFormat:s,inHeight:f,inWidth:d,inChannels:g,outHeight:_,outWidth:D,outChannels:F,padInfo:T,strideHeight:x,strideWidth:S,filterHeight:y,filterWidth:b,effectiveFilterHeight:A,effectiveFilterWidth:z,dilationHeight:E,dilationWidth:I,inShape:t,outShape:v,filterShape:e}}function ya(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function ba(t,e){return e<=1?t:t+(t-1)*(e-1)}function wa(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function ka(t){var e=l(ya(t),3),n=e[0],r=e[1],i=e[2];return 1===n&&1===r&&1===i}function xa(t,e){return ka(t)||ka(e)}function Sa(t,e,n){if(null!=n){if("string"==typeof e)throw Error("Error in "+t+": pad must be an integer when using dimRoundingMode "+n+" but got pad "+e+".");if("number"==typeof e)$n(ir(e),(function(){return"Error in "+t+": pad must be an integer when using dimRoundingMode "+n+" but got pad "+e+"."}));else{if("object"!=typeof e)throw Error("Error in "+t+": Unknown padding parameter: "+e);e.forEach((function(e){e.forEach((function(e){$n(ir(e),(function(){return"Error in "+t+": pad must be an integer when using dimRoundingMode "+n+" but got pad "+e+"."}))}))}))}}}var Na=Ui({avgPool3dGrad_:function(t,e,n,r,i,a){var o=Pi(t,"dy","avgPool3dGrad"),s=Pi(e,"input","avgPool3dGrad"),u=o,l=s,c=!1;4===s.rank&&(c=!0,u=ia(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=ia(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),$n(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+u.rank+"."})),$n(5===l.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+l.rank+"."})),Sa("avgPool3dGrad",i,a);var h={dy:u,input:l},p={filterSize:n,strides:r,pad:i,dimRoundingMode:a},f=Mi.runKernel("AvgPool3DGrad",h,p);return c?ia(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),Ea={kernelName:ze,inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.filterSize,a=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return Na(t,r,i,a,o,s)}}}};var Ia=Ui({avgPoolGrad_:function(t,e,n,r,i){var a=Pi(t,"dy","avgPoolGrad"),o=Pi(e,"input","avgPoolGrad");$n(o.rank===a.rank,(function(){return"Rank of input ("+o.rank+") does not match rank of dy ("+a.rank+")"}));var s=o,u=a,l=!1;3===o.rank&&(l=!0,s=ia(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=ia(a,[1,a.shape[0],a.shape[1],a.shape[2]])),$n(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+u.rank+"."})),$n(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+s.rank+"."}));var c={dy:u,input:s},h={filterSize:n,strides:r,pad:i},p=Mi.runKernel("AvgPoolGrad",c,h);return l?ia(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),Aa={kernelName:Ae,inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.filterSize,a=n.strides,o=n.pad;return{x:function(){return Ia(t,r,i,a,o)}}}};var za=Ui({matMul_:function(t,e,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=Pi(t,"a","matMul"),o=Pi(e,"b","matMul"),s={a:a=(i=l(zi(a,o),2))[0],b:o=i[1]},u={transposeA:n,transposeB:r};return Mi.runKernel(Ce,s,u)}}),Ca={kernelName:Ce,inputsToSave:["a","b"],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return za(t,a,!1,!1)},b:function(){return za(t,i,!0,!1)}}:o&&!s?{a:function(){return za(a,t,!1,!0)},b:function(){return za(i,t,!1,!1)}}:{a:function(){return za(a,t,!0,!0)},b:function(){return za(t,i,!0,!0)}}:{a:function(){return za(t,a,!1,!0)},b:function(){return za(i,t,!0,!1)}}}};var Ta=Ui({spaceToBatchND_:function(t,e,n){var r=Pi(t,"x","spaceToBatchND");$n(r.rank>=1+e.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length})),$n(n.length===e.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length})),$n(r.shape.reduce((function(t,r,i){return i>0&&i<=e.length?t&&(r+n[i-1][0]+n[i-1][1])%e[i-1]==0:t}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()}));var i={x:r},a={blockShape:e,paddings:n};return Mi.runKernel(Ln,i,a)}}),_a={kernelName:Te,gradFunc:function(t,e,n){var r=n.blockShape,i=n.crops;return{x:function(){return Ta(t,r,i)}}}},Da={kernelName:"BroadcastTo",gradFunc:function(t,e,n){for(var r=n,i=r.inputShape,a=r.shape,o=Array.from(a),s=i.length-1;s>=0;s--)if(i[s]===a[s])o[s]=1;else if(1!==i[s])throw new Error("broadcastTo(): ["+i+"] cannot be broadcast to ["+a+"].");var u=[];for(s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return aa(t,u,!0)}}}},Fa={kernelName:_e,gradFunc:function(t){return{x:function(){return t.clone()}}}},Ma={kernelName:De,gradFunc:function(t){return{x:function(){return ua(t)}}}};var La=Ui({greaterEqual_:function(t,e){var n,r=Pi(t,"a","greaterEqual","string_or_numeric"),i=Pi(e,"b","greaterEqual","string_or_numeric");r=(n=l(zi(r,i),2))[0],i=n[1],ra(r.shape,i.shape);var a={a:r,b:i};return Mi.runKernel(Xe,a)}});var Ra=Ui({lessEqual_:function(t,e){var n,r=Pi(t,"a","lessEqual","string_or_numeric"),i=Pi(e,"b","lessEqual","string_or_numeric");r=(n=l(zi(r,i),2))[0],i=n[1],ra(r.shape,i.shape);var a={a:r,b:i};return Mi.runKernel("LessEqual",a)}});var Oa=Ui({logicalAnd_:function(t,e){var n=Pi(t,"a","logicalAnd","bool"),r=Pi(e,"b","logicalAnd","bool");ra(n.shape,r.shape);var i={a:n,b:r};return Mi.runKernel("LogicalAnd",i)}});var Ba=Ui({clone_:function(t){var e={x:Pi(t,"x","clone","string_or_numeric")};return Mi.runKernel($e,e)}});var Pa=Ui({broadcastTo_:function(t,e){var n=Pi(t,"broadcastTo","x"),r=n.shape;if(e.some((function(t){return!(t>0)||t%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<n.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+n.rank+".");if(e.length>n.rank){for(var i=n.shape.slice();i.length<e.length;)i.unshift(1);n=ia(n,i)}for(var a=n.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(a[s]===e[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");if(0===o.map((function(t,e){return t>1?e:-1})).filter((function(t){return t>=0})).length)return Ba(n);var u={x:n},l={reps:o};return Mi.runKernel(Wn,u,l)}});var Wa=Ui({where_:function(t,e,n){var r=Pi(e,"a","where"),i=Pi(n,"b","where"),a=Pi(t,"condition","where","bool"),o=ra(ra(a.shape,r.shape),i.shape),s={condition:Pa(a,o),t:Pa(r,o),e:Pa(i,o)};return Mi.runKernel(An,s)}}),Ua={kernelName:Fe,inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.clipValueMin,a=n.clipValueMax;return{x:function(){return Wa(Oa(La(r,i),Ra(r,a)),t,ua(t))}}}},ja={kernelName:Me,inputsToSave:["x"],gradFunc:qi.gradFunc};var Ka=Ui({split_:function(t,e,n){void 0===n&&(n=0);var r={x:Pi(t,"x","split")},i={numOrSizeSplits:e,axis:n};return Mi.runKernel(Rn,r,i)}}),Va={kernelName:Le,saveAllInputs:!0,gradFunc:function(t,e,n){var r=e.map((function(t){return t.shape})),i=or(n.axis,e[0].shape)[0],a=r.map((function(t){return t[i]}));return Ka(t,a,i).map((function(t){return function(){return t}}))}};var qa=Ui({conv2DBackpropFilter_:function(t,e,n,r,i,a,o){void 0===a&&(a="NHWC");var s=t;3===t.rank&&(s=ia(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var u=e;3===u.rank&&(u=ia(e,[1,e.shape[0],e.shape[1],e.shape[2]])),$n(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),$n(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),$n(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var l="NHWC"===a?s.shape[3]:s.shape[1],c="NHWC"===a?u.shape[3]:u.shape[1];$n(l===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."})),$n(c===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."})),Sa("conv2dDerFilter",i,o);var h={x:s,dy:u},p={strides:r,pad:i,dataFormat:a,dimRoundingMode:o,filterShape:n};return Mi.runKernel("Conv2DBackpropFilter",h,p)}});var Ga=Ui({conv2DBackpropInput_:function(t,e,n,r,i,a,o){void 0===a&&(a="NHWC"),$n(t.length===e.rank,(function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"}));var s=t,u=e,l=!1;3===e.rank&&(l=!0,u=ia(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,t[0],t[1],t[2]]),$n(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),$n(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),$n(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var c="NHWC"===a?s[3]:s[1],h="NHWC"===a?u.shape[3]:u.shape[1];$n(c===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."})),$n(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."})),Sa("conv2dDerInput",i,o);var p={dy:u,filter:n},f={strides:r,pad:i,dataFormat:a,dimRoundingMode:o,inputShape:s},d=Mi.runKernel(Oe,p,f);return l?ia(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Ha={kernelName:Re,inputsToSave:["x","filter"],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return $n(ka(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"})),{x:function(){return Ga(i.shape,t,a,s,u,c)},filter:function(){return qa(i,t,a.shape,s,u,c)}}}};var Ja=Ui({conv2d_:function(t,e,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=Pi(t,"x","conv2d","float32"),u=Pi(e,"filter","conv2d","float32"),l=s,c=!1;3===s.rank&&(c=!0,l=ia(s,[1,s.shape[0],s.shape[1],s.shape[2]])),$n(4===l.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."})),$n(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),Sa("conv2d",r,o);var h="NHWC"===i?l.shape[3]:l.shape[1];$n(h===u.shape[2],(function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."})),$n(xa(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}));var p={x:l,filter:u},f={strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:o},d=Mi.runKernel(Re,p,f);return c?ia(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Za={kernelName:Oe,inputsToSave:["dy","filter"],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return Ja(t,a,o,s,u,1,c)},filter:function(){return qa(t,i,a.shape,o,s,u,c)}}}};var Ya=Ui({conv3DBackpropFilter_:function(t,e,n,r,i){var a=t;4===t.rank&&(a=ia(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));var o=e;4===o.rank&&(o=ia(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),$n(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),$n(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),$n(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),$n(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),$n(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s={x:a,dy:o},u={strides:r,pad:i,filterShape:n};return Mi.runKernel("Conv3DBackpropFilterV2",s,u)}});var Xa=Ui({conv3DBackpropInput_:function(t,e,n,r,i){$n(t.length===e.rank,(function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"}));var a=t,o=e,s=!1;4===e.rank&&(s=!0,o=ia(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),a=[1,t[0],t[1],t[2],t[3]]);var u=a[4],l=o.shape[4];$n(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),$n(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),$n(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),$n(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),$n(l===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."}));var c={dy:o,filter:n},h={pad:i,strides:r,inputShape:a},p=Mi.runKernel("Conv3DBackpropInputV2",c,h);return s?ia(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),$a={kernelName:Be,inputsToSave:["x","filter"],gradFunc:function(t,e,n){var r=n.dilations,i=n.strides,a=n.pad;$n(ka(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+r+"'"}));var o=l(e,2),s=o[0],u=o[1];return{x:function(){return Xa(s.shape,t,u,i,a)},filter:function(){return Ya(s,t,u.shape,i,a)}}}};var Qa=Ui({sin_:function(t){var e={x:Pi(t,"x","sin","float32")};return Mi.runKernel("Sin",e)}}),to={kernelName:"Cos",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ki(Ji(Qa(ji(n,"float32"))),t)}}}};var eo=Ui({sinh_:function(t){var e={x:Pi(t,"x","sinh")};return Mi.runKernel(Tn,e)}}),no={kernelName:Pe,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ki(eo(ji(n,"float32")),t)}}}};function ro(t,e){return function(t,e,n){for(var r=t.length+e.length,i=[],a=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(t[a++]):i.push(e[o++]);return i}(t,e.map((function(t){return 1})),e)}function io(t,e){if(function(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((function(t){return n.push(t)})),n}function ao(t){return t.map((function(t,e){return[e,t]})).sort((function(t,e){return t[1]-e[1]})).map((function(t){return t[0]}))}var oo=Ui({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i={x:Pi(t,"x","cumsum")},a={axis:e,exclusive:n,reverse:r};return Mi.runKernel(We,i,a)}});function so(t,e){return Mi.tidy(t,e)}function uo(t){Ci(t).forEach((function(t){return t.dispose()}))}var lo=Ui({complex_:function(t,e){var n=Pi(t,"real","complex"),r=Pi(e,"imag","complex");Qn(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex().");var i={real:n,imag:r};return Mi.runKernel("Complex",i)}});var co=Ui({imag_:function(t){var e={input:Pi(t,"input","imag")};return Mi.runKernel("Imag",e)}});var ho=Ui({real_:function(t){var e={input:Pi(t,"input","real")};return Mi.runKernel("Real",e)}});var po=Ui({transpose_:function(t,e,n){var r=Pi(t,"x","transpose");if(null==e&&(e=r.shape.map((function(t,e){return e})).reverse()),$n(r.rank===e.length,(function(){return"Error in transpose: rank of input "+r.rank+" must match length of perm "+e+"."})),e.forEach((function(t){$n(t>=0&&t<r.rank,(function(){return"All entries in 'perm' must be between 0 and "+(r.rank-1)+" but got "+e}))})),r.rank<=1)return r.clone();var i={x:r},a={perm:e};return"complex64"===r.dtype?so((function(){var t=ho(r),e=co(r);return t=Mi.runKernel(Un,{x:t},a),e=Mi.runKernel(Un,{x:e},a),n&&(e=Ji(e)),lo(t,e)})):Mi.runKernel(Un,i,a)}}),fo={kernelName:We,inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.axis,a=n.exclusive,o=n.reverse;return{x:function(){var e=io([i],r.rank),n=oo(t,i,a,!o);return null!=e&&(n=po(n,e)),n}}}};var go=Ui({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,i,a,o){void 0===a&&(a=[1,1]);var s=t;3===t.rank&&(s=ia(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var u=e;3===u.rank&&(u=ia(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={x:s,dy:u},c={strides:r,pad:i,dimRoundingMode:o,dilations:a,filterShape:n};return Mi.runKernel("DepthwiseConv2dNativeBackpropFilter",l,c)}});var vo=Ui({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,i,a,o){void 0===a&&(a=[1,1]);var s=e,u=!1;3===e.rank&&(u=!0,s=ia(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={dy:s,filter:n},c={strides:r,pad:i,dimRoundingMode:o,dilations:a,inputShape:t},h=Mi.runKernel("DepthwiseConv2dNativeBackpropInput",l,c);return u?ia(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),mo={kernelName:Ue,inputsToSave:["x","filter"],gradFunc:function(t,e,n){var r=n.dilations,i=n.strides,a=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;$n(ka(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '"+s+"'"}));var u=l(e,2),c=u[0],h=u[1];return $n(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank "+c.rank+"."})),$n(4===h.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank "+h.rank+"."})),$n(c.shape[3]===h.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+h.shape[2]+"."})),$n(xa(i,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides "+i+" and dilations '"+s+"'."})),Sa("depthwiseConv2d",a,o),{x:function(){return vo(c.shape,t,h,i,a,s,o)},filter:function(){return go(c,t,h.shape,i,a,s,o)}}}},yo={kernelName:je,inputsToSave:["x","filter"],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o={x:i,filter:a,dy:t},s={x:i,filter:a,dy:t};return{x:function(){return Mi.runKernel("Dilation2DBackpropInput",o,n)},filter:function(){return Mi.runKernel("Dilation2DBackpropFilter",s,n)}}}},bo={kernelName:"Elu",outputsToSave:[!0],gradFunc:function(t,e){var n={dy:t,y:l(e,1)[0]};return{x:function(){return Mi.runKernel("EluGrad",n)}}}};var wo=Ui({exp_:function(t){var e={x:Pi(t,"x","exp")};return Mi.runKernel("Exp",e)}}),ko={kernelName:"Erf",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0],r=Ki(wo(Ji($i(n))),2/Math.sqrt(Math.PI));return{x:function(){return Ki(t,r)}}}},xo={kernelName:"Exp",outputsToSave:[!0],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ki(t,n)}}}},So={kernelName:qe,inputsToSave:["input"],gradFunc:function(t,e){var n=l(e,1)[0];return{input:function(){return ia(t,n.shape)}}}},No={kernelName:Ge,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ki(t,wo(n))}}}},Eo={kernelName:He,gradFunc:function(t){return{x:function(){return ua(t)}}}},Io={kernelName:Je,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=ra(r.shape,i.shape);return{a:function(){var e=Hi(t,ji(i,"float32")),n=na(r.shape,a);return n.length>0?ia(aa(e,n),r.shape):e},b:function(){var e=Ki(t,ji(r,"float32")),n=na(i.shape,a);n.length>0&&(e=ia(aa(e,n),i.shape));var o=$i(i);return Ji(Hi(e,ji(o,"float32")))}}}};var Ao=Ui({rsqrt_:function(t){var e={x:Pi(t,"x","rsqrt","float32")};return Mi.runKernel(In,e)}});var zo=Ui({tile_:function(t,e){var n=Pi(t,"x","tile","string_or_numeric");$n(n.rank===e.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."}));var r={x:n},i={reps:e};return Mi.runKernel(Wn,r,i)}}),Co={kernelName:Ze,inputsToSave:["x","mean","variance","scale"],gradFunc:function(t,e,n){var r=n.varianceEpsilon,i=l(e,4),a=i[0],o=i[1],s=i[2],u=i[3],c=null==u?Yi(1):u,h=na(o.shape,a.shape),p=[];if(1===o.rank){for(var f=0;f<a.shape.length-1;++f)p.push(a.shape[f]);p.push(1)}var d=Qi(a,o),g=Ki(t,c),v=Ao(pa(s,Yi(r))),m=Ki(Ki(Ki(v,v),v),Yi(-.5));return{x:function(){return 1===o.rank?ia(Ki(Ki(t,zo(ia(v,[1,1,1,o.shape[0]]),p)),c),a.shape):ia(Ki(Ki(t,v),c),a.shape)},mean:function(){var t=Ki(Ki(v,Yi(-1)),g);return 1===o.rank&&(t=aa(t,h)),ia(t,o.shape)},variance:function(){var t=Ki(Ki(m,d),g);return 1===o.rank&&(t=aa(t,h)),ia(t,o.shape)},scale:function(){var e=Ki(d,v),n=Ki(t,e);return 1===o.rank&&(n=aa(n,h)),ia(n,o.shape)},offset:function(){var e=t;return 1===o.rank&&(e=aa(e,h)),ia(e,o.shape)}}}};var To=Ui({unsortedSegmentSum_:function(t,e,n){var r=Pi(t,"x","unsortedSegmentSum"),i=Pi(e,"segmentIds","unsortedSegmentSum","int32");$n(ir(n),(function(){return"numSegments must be of dtype int"}));var a={x:r,segmentIds:i},o={numSegments:n};return Mi.runKernel(Kn,a,o)}}),_o={kernelName:Ye,inputsToSave:["x","indices"],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.axis,s=or(o,i.shape)[0];return{x:function(){var e=i.shape,n=a.size,r=e.slice(0,s),u=r.length,l=e.slice(o,e.length).slice(1),c=l.length,h=Do(0,u),p=Do(u+1,u+1+c),f=Fo([r,[n],l]),d=ia(t,f),g=ia(a,[n]),v=Fo([[u],h,p]),m=po(d,v),y=To(m,g,i.shape[s]),b=ao(v);return y=po(y,b)},indices:function(){return a}}}};function Do(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function Fo(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var Mo={kernelName:Xe,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1];return{a:function(){return ua(r)},b:function(){return ua(i)}}}},Lo={kernelName:$e,gradFunc:function(t){return{x:function(){return ji(t,"float32")}}}},Ro={kernelName:Qe,gradFunc:function(t){return{x:function(){return ua(t)}}}},Oo={kernelName:tn,gradFunc:function(t){return{x:function(){return ua(t)}}}},Bo={kernelName:en,gradFunc:function(t){return{x:function(){return ua(t)}}}};var Po=Ui({greater_:function(t,e){var n,r=Pi(t,"a","greater","string_or_numeric"),i=Pi(e,"b","greater","string_or_numeric");r=(n=l(zi(r,i),2))[0],i=n[1],ra(r.shape,i.shape);var a={a:r,b:i};return Mi.runKernel("Greater",a)}}),Wo={kernelName:nn,inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.alpha,a=Po(r,0);return{x:function(){return Wa(a,t,Ki(t,i))}}}},Uo={kernelName:rn,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Hi(t,pa(n,1))}}}},jo={kernelName:"Log",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Hi(t,ji(n,"float32"))}}}},Ko={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.axis;return{logits:function(){var e=wo(r);return Qi(t,Ki(aa(t,i,!0),e))}}}};var Vo=Ui({localResponseNormalizationBackprop_:function(t,e,n,r,i,a,o){void 0===r&&(r=5),void 0===i&&(i=1),void 0===a&&(a=1),void 0===o&&(o=.5);var s={x:t,y:e,dy:n},u={depthRadius:r,bias:i,alpha:a,beta:o};return Mi.runKernel("LRNGrad",s,u)}}),qo={kernelName:"LRN",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return Vo(i,a,t,o,s,u,c)}}}};var Go=Ui({equal_:function(t,e){var n,r=Pi(t,"a","equal","string_or_numeric"),i=Pi(e,"b","equal","string_or_numeric");r=(n=l(zi(r,i),2))[0],i=n[1],ra(r.shape,i.shape);var a={a:r,b:i};return Mi.runKernel("Equal",a)}});function Ho(t,e,n,r){return e.rank<n.rank&&(e=ia(e,ro(e.shape,r))),t.rank<n.rank&&(t=ia(t,ro(t.shape,r))),{x:function(){return Ki(t,ji(Go(n,e),t.dtype))}}}var Jo={kernelName:"Max",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(t,e,n){var r=n.reductionIndices,i=e[0],a=Ho(t,e[1],i,or(r,i.shape));return{x:function(){return a.x()}}}};var Zo=Ui({less_:function(t,e){var n,r=Pi(t,"a","less","string_or_numeric"),i=Pi(e,"b","less","string_or_numeric");r=(n=l(zi(r,i),2))[0],i=n[1],ra(r.shape,i.shape);var a={a:r,b:i};return Mi.runKernel("Less",a)}}),Yo={kernelName:an,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1];return{a:function(){return Ki(t,ji(La(r,i),"float32"))},b:function(){return Ki(t,ji(Zo(r,i),"float32"))}}}};var Xo=Ui({maxPool3dGrad_:function(t,e,n,r,i,a,o){var s=Pi(t,"dy","maxPool3dGrad"),u=Pi(e,"input","maxPool3dGrad"),l=Pi(n,"output","maxPool3dGrad"),c=s,h=u,p=l,f=!1;4===u.rank&&(f=!0,c=ia(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),h=ia(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),p=ia(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),$n(5===c.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+c.rank+"."})),$n(5===h.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+h.rank+"."})),$n(5===p.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+p.rank+"."})),Sa("maxPool3dGrad",a,o);var d={dy:c,input:h,output:p},g={filterSize:r,strides:i,pad:a,dimRoundingMode:o},v=Mi.runKernel("MaxPool3DGrad",d,g);return f?ia(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),$o={kernelName:sn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;return{x:function(){return Xo(t,i,a,o,s,u,c)}}}};var Qo=Ui({maxPoolGrad_:function(t,e,n,r,i,a,o){var s=Pi(t,"dy","maxPoolGrad"),u=Pi(e,"input","maxPoolGrad"),l=Pi(n,"output","maxPoolGrad");$n(u.rank===s.rank,(function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+s.rank+")"})),$n(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+s.rank+"."})),$n(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+u.rank+"."})),Sa("maxPoolGrad",a,o);var c={dy:s,input:u,output:l},h={filterSize:r,strides:i,pad:a,dimRoundingMode:o};return Mi.runKernel("MaxPoolGrad",c,h)}}),ts={kernelName:on,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return Qo(t,i,a,o,s,u)}}}};function es(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=es(t,"float32"),r=es(t,"float32");return lo(n,r)}var i=vr(nr(t),e);return Mi.makeTensor(i,t,e)}function ns(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=ns(t,"float32"),r=es(t,"float32");return lo(n,r)}var i=gr(nr(t),e);return Mi.makeTensor(i,t,e)}var rs={kernelName:un,inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=or(n.axis,r.shape),a=nr(function(t,e){for(var n=[],r=t.length,i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map((function(e){return t[e]}))]}(r.shape,i)[1]);return{x:function(){var e=r.shape.slice();i.forEach((function(t){e[t]=1}));var n=ia(t,e);return Hi(Ki(n,ns(r.shape,"float32")),a)}}}},is={kernelName:"Min",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(t,e,n){var r=n.axis,i=l(e,2),a=i[0],o=Ho(t,i[1],a,or(r,a.shape));return{x:function(){return o.x()}}}},as={kernelName:ln,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1];return{a:function(){return Ki(t,ji(Ra(r,i),"float32"))},b:function(){return Ki(t,ji(Po(r,i),"float32"))}}}};var os=Ui({slice_:function(t,e,n){var r=Pi(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var i={x:r},a={begin:e,size:n};return Mi.runKernel(Cn,i,a)}}),ss={kernelName:cn,inputsToSave:["x"],gradFunc:function(t,e,n){var r=e[0],i=n.paddings.map((function(t){return t[0]}));return{x:function(){return os(t,i,r.shape)}}}};var us=Ui({floor_:function(t){var e={x:Pi(t,"x","floor","float32")};return Mi.runKernel(He,e)}}),ls={kernelName:"Mod",inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=ra(r.shape,i.shape);return{a:function(){var e=na(r.shape,a);return e.length>0?ia(aa(t,e),r.shape):t},b:function(){var e=Ki(t,Ji(us(Hi(r,i)))),n=na(i.shape,a);return n.length>0?ia(aa(e,n),i.shape):e}}}},cs={kernelName:hn,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=ra(r.shape,i.shape);return{a:function(){var e=Ki(t,ji(i,"float32")),n=na(r.shape,a);return n.length>0?ia(aa(e,n),r.shape):e},b:function(){var e=Ki(t,ji(r,"float32")),n=na(i.shape,a);return n.length>0?ia(aa(e,n),i.shape):e}}}},hs={kernelName:"Neg",gradFunc:function(t){return{x:function(){return Ji(t)}}}},ps={kernelName:fn,inputsToSave:["indices"],gradFunc:function(t,e){var n=e[0];return{indices:function(){return es(n.shape,"float32")}}}},fs={kernelName:pn,gradFunc:function(t){return{x:function(){return ua(t)}}}};var ds=Ui({unstack_:function(t,e){void 0===e&&(e=0);var n=Pi(t,"x","unstack","string_or_numeric");$n(e>=-n.shape.length&&e<n.shape.length,(function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"}));var r={value:n},i={axis:e};return Mi.runKernel(jn,r,i)}}),gs={kernelName:dn,saveAllInputs:!0,gradFunc:function(t,e,n){var r=n.axis;return ds(t,r).map((function(t){return function(){return t}}))}},vs={kernelName:gn,inputsToSave:["x"],gradFunc:function(t,e,n){var r=e[0],i=n.paddings.map((function(t){return t[0]}));return{x:function(){return os(t,i,r.shape)}}}};var ms=Ui({log_:function(t){var e={x:Pi(t,"x","log","float32")};return Mi.runKernel("Log",e)}});var ys=Ui({pow_:function(t,e){var n,r=Pi(t,"base","pow"),i=Pi(e,"exp","pow"),a={a:r=(n=l(zi(r,i),2))[0],b:i=n[1]};return Mi.runKernel("Pow",a)}}),bs={kernelName:"Pow",inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(t,e){var n=l(e,3),r=n[0],i=n[1],a=n[2],o=r,s=i,u=ra(o.shape,s.shape);return{a:function(){var e=ji(s,"float32"),n=Ki(t,Ki(e,ys(o,Qi(e,Yi(1))))),r=na(o.shape,u);return r.length>0&&(n=aa(n,r)),ia(n,o.shape)},b:function(){var e=Po(o,0),n=Wa(e,ms(o),ua(o)),r=Ki(t,Ki(a,n)),i=na(s.shape,u);return i.length>0&&(r=aa(r,i)),ia(r,s.shape)}}}},ws={kernelName:vn,inputsToSave:["x","alpha"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=Po(r,0);return{x:function(){return Wa(a,t,Ki(t,i))},alpha:function(){var e=Wa(a,ua(t),Ki(t,r)),n=na(i.shape,t.shape);return n.length>0&&(e=aa(e,n)),ia(e,i.shape)}}}};var ks=Sr();ks.registerFlag("DEBUG",(function(){return!1}),(function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),ks.registerFlag("IS_BROWSER",(function(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope})),ks.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&"undefined"!=typeof process.versions&&"undefined"!=typeof process.versions.node})),ks.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),ks.registerFlag("PROD",(function(){return!1})),ks.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return ks.getBool("DEBUG")})),ks.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),ks.registerFlag("IS_TEST",(function(){return!1})),ks.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),ks.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),ks.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var xs="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Ss(t){return xs?Buffer.byteLength(t):new Blob([t]).size}function Ns(t){if(1===t.length)return t[0];var e=0;t.forEach((function(t){e+=t.byteLength}));var n=new Uint8Array(e),r=0;return t.forEach((function(t){n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function Es(t,e){var n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}function Is(t,e){return o(this,void 0,void 0,(function(){var n,r,i,a;return s(this,(function(o){switch(o.label){case 0:return n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy},null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),null==t.weightsManifest?[3,2]:[4,e(t.weightsManifest)];case 1:r=l.apply(void 0,[o.sent(),2]),i=r[0],a=r[1],n.weightSpecs=i,n.weightData=a,o.label=2;case 2:return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),[2,n]}}))}))}function As(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:Ss(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:Ss(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var zs=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var i=[];return("load"===n?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach((function(t){var n=t(e,r);null!==n&&i.push(n)})),i},t}(),Cs="models_store",Ts="model_info_store";var _s=function(){function t(t){if(this.indexedDB=function(){if(!Sr().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]}))}))},t.prototype.load=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.databaseAction(this.modelPath)]}))}))},t.prototype.databaseAction=function(t,e){var n=this;return new Promise((function(t,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return function(t){var e=t.result;e.createObjectStore(Cs,{keyPath:"modelPath"}),e.createObjectStore(Ts,{keyPath:"modelPath"})}(i)},i.onsuccess=function(){var a=i.result;if(null==e){var o=a.transaction(Cs,"readonly"),s=o.objectStore(Cs).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return a.close(),r(s.error)},o.oncomplete=function(){return a.close()}}else{var u,l=As(e),c=a.transaction(Ts,"readwrite"),h=c.objectStore(Ts),p=h.put({modelPath:n.modelPath,modelArtifactsInfo:l});p.onsuccess=function(){var i=(u=a.transaction(Cs,"readwrite")).objectStore(Cs).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:l});i.onsuccess=function(){return t({modelArtifactsInfo:l})},i.onerror=function(t){var e=(h=c.objectStore(Ts)).delete(n.modelPath);e.onsuccess=function(){return a.close(),r(i.error)},e.onerror=function(t){return a.close(),r(i.error)}}},p.onerror=function(t){return a.close(),r(p.error)},c.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},i.onerror=function(t){return r(i.error)}}))},t}();_s.URL_SCHEME="indexeddb://";var Ds=function(t){return Sr().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(_s.URL_SCHEME)?(e=t.slice(_s.URL_SCHEME.length),new _s(e)):null;var e};zs.registerSaveRouter(Ds),zs.registerLoadRouter(Ds);var Fs="/",Ms="tensorflowjs_models",Ls="info",Rs="model_topology",Os="weight_specs",Bs="weight_data",Ps="model_metadata";var Ws=function(){function t(t){if(!Sr().getBool("IS_BROWSER")||"undefined"==typeof window||"undefined"==typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");var e;this.modelPath=t,this.keys=(e=this.modelPath,{info:[Ms,e,Ls].join(Fs),topology:[Ms,e,Rs].join(Fs),weightSpecs:[Ms,e,Os].join(Fs),weightData:[Ms,e,Bs].join(Fs),modelMetadata:[Ms,e,Ps].join(Fs)})}return t.prototype.save=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i;return s(this,(function(a){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=As(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(xs)return Buffer.from(t).toString("base64");for(var e=new Uint8Array(t),n="",r=0,i=e.length;r<i;r++)n+=String.fromCharCode(e[r]);return btoa(n)}(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),[2,{modelArtifactsInfo:r}]}catch(t){throw function(t){var e,n;try{for(var r=u(Object.values(t)),i=r.next();!i.done;i=r.next()){var a=i.value;window.localStorage.removeItem(a)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}(this.keys),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},t.prototype.load=function(){return o(this,void 0,void 0,(function(){var t,e,n,r,i,a,o;return s(this,(function(s){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy,null!=a.signature&&(e.signature=a.signature),null!=a.userDefinedMetadata&&(e.userDefinedMetadata=a.userDefinedMetadata),null!=a.modelInitializer&&(e.modelInitializer=a.modelInitializer),null!=a.trainingConfig&&(e.trainingConfig=a.trainingConfig)),null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(xs){var e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var n=atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r.set([n.charCodeAt(i)],i);return r.buffer}(o),[2,e]}))}))},t}();Ws.URL_SCHEME="localstorage://";var Us=function(t){return Sr().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ws.URL_SCHEME)?(e=t.slice(Ws.URL_SCHEME.length),new Ws(e)):null;var e};zs.registerSaveRouter(Us),zs.registerLoadRouter(Us);function js(t){return new Promise((function(t){return setTimeout(t)})).then(t)}var Ks=function(){function t(e){if(!Sr().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelJsonFileName=e+".json",this.weightDataFileName=e+".weights.bin"}return t.prototype.save=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],r=Es(t,n),i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,a.href=i,[4,js((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return s.sent(),null==t.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=e,[4,js((function(){return o.dispatchEvent(new MouseEvent("click"))}))]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:As(t)}]}}))}))},t}();Ks.URL_SCHEME="downloads://";function Vs(t,e,n,r){!function(t){$n(null!=t&&Array.isArray(t)&&t.length>0,(function(){return"promises must be a none empty array"}))}(t),function(t,e){$n(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+t})),$n(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e})),$n(e>=t,(function(){return"startFraction must be no more than endFraction, but got startFraction "+t+" and endFraction "+e}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(t.map((function(a){return a.then((function(a){var o=n+ ++i/t.length*(r-n);return e(o),a})),a})))}function qs(t,e){return o(this,void 0,void 0,(function(){var n,r,i,a,o,u,l,c,h;return s(this,(function(s){switch(s.label){case 0:return null==e&&(e={}),n=null==e.fetchFunc?Sr().platform.fetch:e.fetchFunc,r=t.map((function(t){return n(t,e.requestInit,{isBinary:!0})})),i=0,a=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return o=s.sent(),[3,4];case 2:return[4,Vs(r,e.onProgress,i,a)];case 3:o=s.sent(),s.label=4;case 4:return u=o.map((function(t){return t.arrayBuffer()})),l=.5,c=1,null!=e.onProgress?[3,6]:[4,Promise.all(u)];case 5:return h=s.sent(),[3,8];case 6:return[4,Vs(u,e.onProgress,l,c)];case 7:h=s.sent(),s.label=8;case 8:return[2,h]}}))}))}zs.registerSaveRouter((function(t){return Sr().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ks.URL_SCHEME)?function(t){void 0===t&&(t="model");return new Ks(t)}(t.slice(Ks.URL_SCHEME.length)):null}));var Gs=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?($n("function"==typeof e.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=e.fetchFunc):this.fetch=Sr().platform.fetch,$n(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&$n(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."})),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i;return s(this,(function(a){switch(a.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],r=Es(t,n),e.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:As(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}}))}))},t.prototype.load=function(){return o(this,void 0,void 0,(function(){var t,e,n,r,i,a=this;return s(this,(function(o){switch(o.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=o.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");o.label=2;case 2:return o.trys.push([2,4,,5]),[4,t.json()];case 3:return e=o.sent(),[3,5];case 4:throw o.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=e.modelTopology,i=e.weightsManifest,null==r&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return[2,Is(e,(function(t){return a.loadWeights(t)}))]}}))}))},t.prototype.loadWeights=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i,a,o,h,p,f,d,g,v,m,y,b,w,k,x,S,N,E,I,A,z,C,T,_;return s(this,(function(s){switch(s.label){case 0:e=Array.isArray(this.path)?this.path[1]:this.path,n=l(function(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),i=n>e?t.substring(n):"";return[r+"/",i]}(e),2),r=n[0],i=n[1],a=this.weightPathPrefix||r,o=[];try{for(h=u(t),p=h.next();!p.done;p=h.next())f=p.value,o.push.apply(o,c(f.weights))}catch(t){I={error:t}}finally{try{p&&!p.done&&(A=h.return)&&A.call(h)}finally{if(I)throw I.error}}d=[],g=[];try{for(v=u(t),m=v.next();!m.done;m=v.next()){y=m.value;try{for(T=void 0,b=u(y.paths),w=b.next();!w.done;w=b.next())k=w.value,null!=this.weightUrlConverter?g.push(this.weightUrlConverter(k)):d.push(a+k+i)}catch(t){T={error:t}}finally{try{w&&!w.done&&(_=b.return)&&_.call(b)}finally{if(T)throw T.error}}}}catch(t){z={error:t}}finally{try{m&&!m.done&&(C=v.return)&&C.call(v)}finally{if(z)throw z.error}}return this.weightUrlConverter?(S=(x=d.push).apply,N=[d],[4,Promise.all(g)]):[3,2];case 1:S.apply(x,N.concat([c.apply(void 0,[s.sent()])])),s.label=2;case 2:return[4,qs(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return E=s.sent(),[2,[o,Ns(E)]]}}))}))},t}();function Hs(t){return null!=t.match(Gs.URL_SCHEME_REGEX)}Gs.URL_SCHEME_REGEX=/^https?:\/\//;var Js=function(t,e){if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;return(Array.isArray(t)?t.every((function(t){return Hs(t)})):Hs(t))?function(t,e){return new Gs(t,e)}(t,e):null};zs.registerSaveRouter(Js),zs.registerLoadRouter(Js);var Zs,Ys=Ui({oneHot_:function(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i={indices:Pi(t,"indices","oneHot","int32")},a={depth:e,onValue:n,offValue:r};return Mi.runKernel(fn,i,a)}});function Xs(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}!function(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(a+" update.rank < "+i+". ");if(t.length<r+(n.rank-i))throw new Error(a+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+t.length-r)throw new Error(a+" update.rank != "+(i+t.length-r));for(var o=0;o<i;++o)if(n.shape[o]!==e.shape[o])throw new Error(a+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+").");for(o=0;o<n.rank-i;++o)if(n.shape[o+i]!==t[o+r])throw new Error(a+" updates.shape["+(o+i)+"] ("+n.shape[o+i]+") != shape["+(o+i)+"] ("+t[o+i]+")")}(n,e,t)}Ui({confusionMatrix_:function(t,e,n){var r=Pi(t,"labels","confusionMatrix"),i=Pi(e,"predictions","confusionMatrix");$n(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),$n(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),$n(1===i.rank,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),$n(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),$n(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var a=Ys(ji(r,"int32"),n),o=Ys(ji(i,"int32"),n),s=po(a),u=za(s,o);return ji(u,"int32")}}),Ui({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,a=!1,o=!1,s=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)a=!0;else if(null!=t.getContext)o=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);s=!0}if(i){if(i&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=_r(Gn,Mi.backendName)){var u={pixels:t},c={numChannels:e};return Mi.runKernel(Gn,u,c)}var h,p,f=l(i?[t.videoWidth,t.videoHeight]:[t.width,t.height],2),d=f[0],g=f[1];if(o)h=t.getContext("2d").getImageData(0,0,d,g).data;else if(r||n)h=t.data;else if(a||i||s){if(null==Zs)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Zs=new OffscreenCanvas(1,1).getContext("2d")}else Zs=document.createElement("canvas").getContext("2d");Zs.canvas.width=d,Zs.canvas.height=g,Zs.drawImage(t,0,0,d,g),h=Zs.getImageData(0,0,d,g).data}if(4===e)p=new Int32Array(h);else{var v=d*g;p=new Int32Array(v*e);for(var m=0;m<v;m++)for(var y=0;y<e;++y)p[m*e+y]=h[4*m+y]}return function(t,e,n){if(tr(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Ri(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Zi(t,e,r,n)}(p,[g,d,e],"int32")}});var $s=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),Qs=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function tu(t){$n(null!=t.className,(function(){return"Class being registered does not have the static className property defined."})),$n("string"==typeof t.className,(function(){return"className is required to be a string, but got type "+typeof t.className})),$n(t.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),Qs.register(t)}var eu=Ui({abs_:function(t){var e=Pi(t,"x","abs");if("complex64"===e.dtype){var n={x:e};return Mi.runKernel(Me,n)}return n={x:e},Mi.runKernel("Abs",n)}});Ui({acos_:function(t){var e={x:Pi(t,"x","acos")};return Mi.runKernel(ve,e)}}),Ui({acosh_:function(t){var e={x:Pi(t,"x","acosh")};return Mi.runKernel(me,e)}}),Ui({addN_:function(t){$n(Array.isArray(t),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),$n(t.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length}));var e=t.map((function(t,e){return Pi(t,"tensors"+e,"addN")})),n=e[0];e.forEach((function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((function(t){if(!rr(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=e;return Mi.runKernel(be,r)}}),Ui({all_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r={x:Pi(t,"x","all","bool")},i={axis:e,keepDims:n};return Mi.runKernel("All",r,i)}}),Ui({any_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r={x:Pi(t,"x","any","bool")},i={axis:e,keepDims:n};return Mi.runKernel("Any",r,i)}}),Ui({argMax_:function(t,e){void 0===e&&(e=0);var n={x:Pi(t,"x","argMax")},r={axis:e};return Mi.runKernel(we,n,r)}}),Ui({argMin_:function(t,e){void 0===e&&(e=0);var n={x:Pi(t,"x","argMin")},r={axis:e};return Mi.runKernel(ke,n,r)}}),Ui({asin_:function(t